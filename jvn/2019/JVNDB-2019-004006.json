{
  "vulinfo_id": "JVNDB-2019-004006",
  "title": "Microsoft Windows タスクスケジューラにおける権限昇格の脆弱性",
  "vulinfo_description": "Microsoft Windows には、タスクスケジューラの SetJobFileSecurityByName() 関数に起因する権限昇格の脆弱性が存在します。  タスクスケジューラは、決められた時間にタスクを実行するための、Microsoft Windows が持つコンポーネントです。schtasks.exe がタスクスケジューラのフロントエンドを担い、SYSTEM 権限で動作する Windows サービスがバックエンドとして機能します。タスクスケジューラが用いる schedsvc.dll というライブラリの中に tsched::SetJobFileSecurityByName() と呼ばれる関数がありますが、この関数により各 .job ファイルのアクセス権限が設定されます。  タスクスケジューラは \u003ca href=\"https://docs.microsoft.com/en-us/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo\"\u003eSetSecurityInfo()\u003c/a\u003e\u0026nbsp;関数が呼ばれた時点で NT Authority\\SYSTEM トークンを持ちます。そのため、タスクスケジューラは本来であれば SYSTEM あるいは他の高い権限を持つアカウントでなければコントロールできないはずのファイルに、フルアクセス権限を付与することができます。  Windows Vista より古い Windows では、%Windir%\\tasks ディレクトリの .job ファイルが使用されます。このような古いバージョンの Windows に由来する schtasks.exe を新しいバージョンの Windows で動作させた場合、これらの .job ファイルは %Windir%\\system32\\tasks ディレクトリに移動されますが、その際に NT Authority\\SYSTEM トークンを持つタスクスケジューラにより、すべてのアカウントに対するフルアクセス権限を持つハードリンクが作成されることになります。本脆弱性の発見者により公開された実証コードはこのようなタスクスケジューラの挙動を利用したものです。  本脆弱性について CERT/CC では公開された実証コードが、32 ビットおよび 64 ビットの Windows 10、Windows 2016 および Windows 2019 で動作することを確認しています。Windows 8 では、本実証コードは一般ユーザが書き込み権限をもつファイルに対してのみ有効であり、攻撃の有効性はごくわずかであると考えられます。Windows 7 においては本実証コードは有効ではありません。",
  "affected": [
    {
      "name": "マイクロソフト",
      "product_name": "Microsoft Windows 10",
      "version_number": [
        "32ビット版 および 64ビット版"
      ],
      "cpe": {
        "version": "2.2",
        "text": "cpe:/o:microsoft:windows_10"
      }
    },
    {
      "name": "マイクロソフト",
      "product_name": "Microsoft Windows 8",
      "cpe": {
        "version": "2.2",
        "text": "cpe:/o:microsoft:windows_8"
      }
    },
    {
      "name": "マイクロソフト",
      "product_name": "Microsoft Windows Server 2016",
      "cpe": {
        "version": "2.2",
        "text": "cpe:/o:microsoft:windows_server_2016"
      }
    },
    {
      "name": "マイクロソフト",
      "product_name": "Microsoft Windows Server 2019",
      "cpe": {
        "version": "2.2",
        "text": "cpe:/o:microsoft:windows_server_2019"
      }
    }
  ],
  "impact": {
    "impact_item": "一般ユーザ権限を持つ攻撃者により、保護されたファイルに対するフルアクセス権限を取得され、結果としてシステムを改ざんされる可能性があります。"
  },
  "solution": "[アップデートする] \u003ca href=\"https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1069\"\u003e開発者が提供する情報\u003c/a\u003eをもとに、最新版にアップデートしてください。",
  "related": [
    {
      "type": "vendor",
      "name": "Security Update Guide",
      "vulinfo_id": "CVE-2019-1069 | Task Scheduler Elevation of Privilege Vulnerability",
      "url": "https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-1069"
    },
    {
      "type": "vendor",
      "name": "Windows Dev Center",
      "vulinfo_id": "SetSecurityInfo function",
      "url": "https://docs.microsoft.com/en-us/windows/desktop/api/aclapi/nf-aclapi-setsecurityinfo"
    },
    {
      "type": "vendor",
      "name": "Windows Dev Center",
      "vulinfo_id": "Hard Links and Junctions",
      "url": "https://docs.microsoft.com/en-us/windows/desktop/fileio/hard-links-and-junctions"
    },
    {
      "type": "advisory",
      "name": "Common Vulnerabilities and Exposures (CVE)",
      "vulinfo_id": "CVE-2019-1069",
      "url": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-1069"
    },
    {
      "type": "advisory",
      "name": "JVN",
      "vulinfo_id": "JVNVU#93881163",
      "url": "http://jvn.jp/cert/JVNVU93881163"
    },
    {
      "type": "advisory",
      "name": "National Vulnerability Database (NVD)",
      "vulinfo_id": "CVE-2019-1069",
      "url": "https://nvd.nist.gov/vuln/detail/CVE-2019-1069"
    },
    {
      "type": "advisory",
      "name": "US-CERT Vulnerability Note",
      "vulinfo_id": "VU#119704",
      "url": "https://www.kb.cert.org/vuls/id/119704"
    },
    {
      "type": "advisory",
      "name": "関連文書",
      "vulinfo_id": "polarbearrepo",
      "url": "https://github.com/SandboxEscaper/polarbearrepo"
    },
    {
      "type": "advisory",
      "name": "関連文書",
      "vulinfo_id": "Exploiting the Windows Task Scheduler Through CVE-2019-1069",
      "url": "https://www.thezdi.com/blog/2019/6/11/exploiting-the-windows-task-scheduler-through-cve-2019-1069"
    }
  ],
  "history": [
    {
      "history_no": "1",
      "date_time": "2019-05-27T02:14:02Z",
      "description": "[2019年05月27日]\\n  掲載"
    },
    {
      "history_no": "2",
      "date_time": "2019-06-14T00:56:57Z",
      "description": "[2019年06月14日]\\n  対策：内容を更新\\n  ベンダ情報：Security Update Guide (CVE-2019-1069 | Task Scheduler Elevation of Privilege Vulnerability) を追加\\n  参考情報：Common Vulnerabilities and Exposures (CVE)(CVE-2019-1069) を追加\\n  参考情報：関連文書 (Exploiting the Windows Task Scheduler Through CVE-2019-1069) を追加"
    },
    {
      "history_no": "3",
      "date_time": "2019-09-30T08:27:04Z",
      "description": "[2019年09月30日]\\n  参考情報：National Vulnerability Database (NVD) (CVE-2019-1069) を追加"
    }
  ],
  "date_first_published": "2019-05-27T11:14:02+09:00",
  "date_last_updated": "2019-10-01T10:44:59+09:00",
  "date_public": "2019-05-22T00:00:00+09:00"
}

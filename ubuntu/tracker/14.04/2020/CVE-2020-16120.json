{
  "candidate": "CVE-2020-16120",
  "description": "Overlayfs did not properly perform permission checking when copying up files in an overlayfs and could be exploited from within a user namespace, if, for example, unprivileged user namespaces were allowed. It was possible to have a file not readable by an unprivileged user to be copied to a mountpoint controlled by the user, like a removable device. This was introduced in kernel version 4.19 by commit d1d04ef (\"ovl: stack file ops\"). This was fixed in kernel version 5.8 by commits 56230d9 (\"ovl: verify permissions in ovl_path_open()\"), 48bd024 (\"ovl: switch to mounter creds in readdir\") and 05acefb (\"ovl: check permission to open real file\"). Additionally, commits 130fdbc (\"ovl: pass correct flags for opening real directory\") and 292f902 (\"ovl: call secutiry hook in ovl_real_ioctl()\") in kernel 5.8 might also be desired or necessary. These additional commits introduced a regression in overlay mounts within user namespaces which prevented access to files with ownership outside of the user namespace. This regression was mitigated by subsequent commit b6650da (\"ovl: do not fail because of O_NOATIMEi\") in kernel 5.11.",
  "ubuntu_description": "Giuseppe Scrivano discovered that the overlay file system in the Linux kernel did not properly perform permission checks in some situations. A local attacker could possibly use this to bypass intended restrictions and gain read access to restricted files.",
  "notes": {
    "sbeattie": "this issue most likely only has an impact on Ubuntu systems as it is dependent on both unprivileged user namespaces being enabled as well as a non-upstream patch that allows overlayfs mounts in user namespaces. the backport of this issue introduced a regression, LP: #1900141"
  },
  "priority": "medium",
  "cvss": {
    "nvd": {
      "vector": "CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:N/A:N",
      "score": 4.4,
      "severity": "MEDIUM"
    }
  },
  "mitigation": "disable unprivileged user namespaces if not needed via\n  sudo sysctl kernel.unprivileged_userns_clone=0\ndo this permanently by adding\n  kernel.unprivileged_userns_clone = 0\nto /etc/sysctl.d/99-userns.conf",
  "bugs": [
    "https://bugs.launchpad.net/bugs/1894980",
    "https://bugs.launchpad.net/bugs/1900141"
  ],
  "references": [
    "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-16120",
    "https://www.openwall.com/lists/oss-security/2020/10/13/6",
    "https://ubuntu.com/security/notices/USN-4578-1",
    "https://ubuntu.com/security/notices/USN-4577-1",
    "https://ubuntu.com/security/notices/USN-4576-1"
  ],
  "assigned_to": "cascardo",
  "discovered_by": "Giuseppe Scrivano",
  "public_date": "2021-02-10T20:15:00Z",
  "public_date_at_usn": "2020-10-13T17:00:00Z",
  "crd": "2020-10-13T17:00:00Z",
  "packages": [
    {
      "name": "linux-aws-5.0",
      "status": "DNE"
    },
    {
      "name": "linux-azure-5.4",
      "status": "DNE"
    },
    {
      "name": "linux-raspi-5.4",
      "status": "DNE"
    },
    {
      "name": "linux-hwe",
      "status": "DNE"
    },
    {
      "name": "linux-hwe-edge",
      "status": "DNE"
    },
    {
      "name": "linux-aws-5.3",
      "status": "DNE"
    },
    {
      "name": "linux-gke-5.3",
      "status": "DNE"
    },
    {
      "name": "linux-oracle-5.3",
      "status": "DNE"
    },
    {
      "name": "linux-hwe-5.4",
      "status": "DNE"
    },
    {
      "name": "linux-lts-trusty",
      "status": "DNE"
    },
    {
      "name": "linux-aws",
      "status": "ignored",
      "note": "out of standard support"
    },
    {
      "name": "linux-gcp-5.3",
      "status": "DNE"
    },
    {
      "name": "linux-gcp-edge",
      "status": "DNE"
    },
    {
      "name": "linux-gke-5.0",
      "status": "DNE"
    },
    {
      "name": "linux-oem-5.6",
      "status": "DNE"
    },
    {
      "name": "linux-oem-osp1",
      "status": "DNE"
    },
    {
      "name": "linux",
      "status": "ignored",
      "note": "out of standard support",
      "patches": [
        {
          "source": "introduced-by",
          "text": "-"
        },
        {
          "source": "fixed-by",
          "text": "56230d956739b9cb1cbde439d76227d77979a04d"
        },
        {
          "source": "introduced-by",
          "text": "-"
        },
        {
          "source": "fixed-by",
          "text": "48bd024b8a40d73ad6b086de2615738da0c7004f"
        },
        {
          "source": "introduced-by",
          "text": "d1d04ef8572bc8c22265057bd3d5a79f223f8f52"
        },
        {
          "source": "fixed-by",
          "text": "05acefb4872dae89e772729efb194af754c877e8"
        }
      ]
    },
    {
      "name": "linux-kvm",
      "status": "DNE"
    },
    {
      "name": "linux-aws-5.4",
      "status": "DNE"
    },
    {
      "name": "linux-oracle-5.0",
      "status": "DNE"
    },
    {
      "name": "linux-raspi2",
      "status": "DNE"
    },
    {
      "name": "linux-lts-xenial",
      "status": "ignored",
      "note": "out of standard support"
    },
    {
      "name": "linux-gke-4.15",
      "status": "DNE"
    },
    {
      "name": "linux-riscv",
      "status": "DNE"
    },
    {
      "name": "linux-gkeop",
      "status": "DNE"
    },
    {
      "name": "linux-aws-hwe",
      "status": "DNE"
    },
    {
      "name": "linux-gcp-4.15",
      "status": "DNE"
    },
    {
      "name": "linux-oracle",
      "status": "DNE"
    },
    {
      "name": "linux-oracle-5.4",
      "status": "DNE"
    },
    {
      "name": "linux-oem",
      "status": "DNE"
    },
    {
      "name": "linux-hwe-5.8",
      "status": "DNE"
    },
    {
      "name": "linux-dell300x",
      "status": "DNE"
    },
    {
      "name": "linux-oem-5.10",
      "status": "DNE"
    },
    {
      "name": "linux-azure",
      "status": "ignored",
      "note": "out of standard support"
    },
    {
      "name": "linux-azure-4.15",
      "status": "DNE"
    },
    {
      "name": "linux-azure-5.3",
      "status": "DNE"
    },
    {
      "name": "linux-azure-edge",
      "status": "DNE"
    },
    {
      "name": "linux-gcp",
      "status": "DNE"
    },
    {
      "name": "linux-gcp-5.4",
      "status": "DNE"
    },
    {
      "name": "linux-raspi2-5.3",
      "status": "DNE"
    },
    {
      "name": "linux-snapdragon",
      "status": "DNE"
    },
    {
      "name": "linux-gke-5.4",
      "status": "DNE"
    },
    {
      "name": "linux-gkeop-5.4",
      "status": "DNE"
    },
    {
      "name": "linux-raspi",
      "status": "DNE"
    }
  ]
}

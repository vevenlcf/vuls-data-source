{
  "candidate": "CVE-2014-1737",
  "description": "The raw_cmd_copyin function in drivers/block/floppy.c in the Linux kernel through 3.14.3 does not properly handle error conditions during processing of an FDRAWCMD ioctl call, which allows local users to trigger kfree operations and gain privileges by leveraging write access to a /dev/fd device. First, raw_cmd_ioctl calls raw_cmd_copyin. This function kmallocs space for a floppy_raw_cmd structure and stores the resulting allocation in the \"rcmd\" pointer argument. It then attempts to copy_from_user the structure from userspace. If this fails, an early EFAULT return is taken. The problem is that even if the early return is taken, the pointer to the non-/partially-initialized floppy_raw_cmd structure has already been returned via the \"rcmd\" pointer. Back out in raw_cmd_ioctl, it attempts to raw_cmd_free this pointer. raw_cmd_free attempts to free any DMA pages allocated for the raw command, kfrees the raw command structure itself, and follows the linked list, if any, of further raw commands (a user can specify the FD_RAW_MORE flag to signal that there are more raw commands to follow in a single FDRAWCMD ioctl). So, a malicious user can send a FDRAWCMD ioctl with a raw command argument structure that has some bytes inaccessible (ie. off the end of an allocated page). The copy_from_user will fail but raw_cmd_free will attempt to process the floppy_raw_cmd as if it had been fully initialized by the rest of raw_cmd_copyin. The user can control the arguments passed to fd_dma_mem_free and kfree (by making use of the linked-list feature and specifying the target address as a next-in-list structure).",
  "ubuntu_description": "Matthew Daley reported a flaw in the handling of ioctl commands by the floppy disk driver in the Linux kernel. An unprivileged local user could exploit this flaw to gain administrative privileges if the floppy disk module is loaded.",
  "notes": {
    "jdstrand": "android kernels (goldfish, grouper, maguro, mako and manta) are not supported on the Ubuntu Touch 13.10 preview kernels android kernels (flo, goldfish, grouper, maguro, mako and manta) are not supported on the Ubuntu Touch 14.04 preview kernels"
  },
  "priority": "high",
  "bugs": [
    "https://launchpad.net/bugs/1316729"
  ],
  "references": [
    "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-1737",
    "https://ubuntu.com/security/notices/USN-2219-1",
    "https://ubuntu.com/security/notices/USN-2220-1",
    "https://ubuntu.com/security/notices/USN-2221-1",
    "https://ubuntu.com/security/notices/USN-2223-1",
    "https://ubuntu.com/security/notices/USN-2224-1",
    "https://ubuntu.com/security/notices/USN-2225-1",
    "https://ubuntu.com/security/notices/USN-2226-1",
    "https://ubuntu.com/security/notices/USN-2227-1",
    "https://ubuntu.com/security/notices/USN-2228-1",
    "https://ubuntu.com/security/notices/USN-2260-1"
  ],
  "public_date": "2014-05-11T21:55:00Z",
  "public_date_at_usn": "2014-05-11T00:00:00Z",
  "packages": [
    {
      "name": "linux",
      "status": "released",
      "note": "3.13.0-27.50",
      "patches": [
        {
          "source": "introduced-by",
          "text": "-"
        },
        {
          "source": "fixed-by",
          "text": "ef87dbe7614341c2e7bfe8d32fcb7028cc97442c"
        }
      ]
    },
    {
      "name": "linux-ec2",
      "status": "DNE"
    },
    {
      "name": "linux-mvl-dove",
      "status": "DNE"
    },
    {
      "name": "linux-snapdragon",
      "status": "DNE"
    },
    {
      "name": "linux-goldfish",
      "status": "ignored",
      "note": "was needed now end-of-life"
    },
    {
      "name": "linux-manta",
      "status": "ignored",
      "note": "was needed now end-of-life"
    },
    {
      "name": "linux-lts-utopic",
      "status": "not-affected",
      "note": "3.16.0-25.33~14.04.2"
    },
    {
      "name": "linux-armadaxp",
      "status": "DNE",
      "tags": [
        "not-ue"
      ]
    },
    {
      "name": "linux-gke",
      "status": "DNE"
    },
    {
      "name": "linux-ti-omap4",
      "status": "DNE"
    },
    {
      "name": "linux-linaro-shared",
      "status": "DNE"
    },
    {
      "name": "linux-lts-vivid",
      "status": "not-affected",
      "note": "3.19.0-18.18~14.04.1"
    },
    {
      "name": "linux-fsl-imx51",
      "status": "DNE"
    },
    {
      "name": "linux-lts-saucy",
      "status": "DNE"
    },
    {
      "name": "linux-grouper",
      "status": "ignored",
      "note": "abandoned"
    },
    {
      "name": "linux-qcm-msm",
      "status": "DNE"
    },
    {
      "name": "linux-lts-wily",
      "status": "not-affected",
      "note": "4.2.0-18.22~14.04.1"
    },
    {
      "name": "linux-raspi2",
      "status": "DNE"
    },
    {
      "name": "linux-mako",
      "status": "ignored",
      "note": "was needed now end-of-life"
    },
    {
      "name": "linux-flo",
      "status": "ignored",
      "note": "was needed now end-of-life"
    },
    {
      "name": "linux-lts-xenial",
      "status": "not-affected",
      "note": "4.4.0-13.29~14.04.1"
    },
    {
      "name": "linux-aws",
      "status": "not-affected",
      "note": "4.4.0-1002.2"
    },
    {
      "name": "linux-hwe",
      "status": "DNE"
    },
    {
      "name": "linux-linaro-vexpress",
      "status": "DNE"
    },
    {
      "name": "linux-lts-raring",
      "status": "DNE"
    },
    {
      "name": "linux-maguro",
      "status": "ignored",
      "note": "abandoned"
    },
    {
      "name": "linux-hwe-edge",
      "status": "DNE"
    },
    {
      "name": "linux-linaro-omap",
      "status": "DNE"
    },
    {
      "name": "linux-lts-quantal",
      "status": "DNE"
    },
    {
      "name": "linux-lts-trusty",
      "status": "DNE"
    }
  ]
}

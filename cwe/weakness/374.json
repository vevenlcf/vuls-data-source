{
  "id": "374",
  "name": "Passing Mutable Objects to an Untrusted Method",
  "abstraction": "Base",
  "structure": "Simple",
  "status": "Draft",
  "description": "The program sends non-cloned mutable data as an argument to a method or function.",
  "extended_description": "The function or method that has been called can alter or delete the mutable data. This could violate assumptions that the calling function has made about its state. In situations where unknown code is called with references to mutable data, this external code could make changes to the data sent. If this data was not previously cloned, the modified data might not be valid in the context of execution.",
  "related_weaknesses": [
    {
      "nature": "ChildOf",
      "cweid": "668",
      "view_id": "1000",
      "ordinal": "Primary"
    }
  ],
  "applicable_platforms": {
    "language": [
      {
        "prevalence": "Undetermined",
        "name": "C"
      },
      {
        "prevalence": "Undetermined",
        "name": "C++"
      },
      {
        "prevalence": "Undetermined",
        "name": "Java"
      },
      {
        "prevalence": "Undetermined",
        "name": "C#"
      }
    ]
  },
  "modes_of_introduction": [
    {
      "phase": "Implementation"
    }
  ],
  "likelihood_of_exploit": "Medium",
  "common_consequences": [
    {
      "scope": [
        "Integrity"
      ],
      "impact": [
        "Modify Memory"
      ],
      "note": "Potentially data could be tampered with by another function which should not have been tampered with."
    }
  ],
  "potential_mitigations": [
    {
      "phase": [
        "Implementation"
      ],
      "description": [
        "Pass in data which should not be altered as constant or immutable."
      ]
    },
    {
      "phase": [
        "Implementation"
      ],
      "description": [
        "Clone all mutable data before passing it into an external function . This is the preferred mitigation. This way, regardless of what changes are made to the data, a valid copy is retained for use by the class."
      ]
    }
  ],
  "demonstrative_examples": [
    {
      "text": "\n               \u003cIntro_Text\u003eThe following example demonstrates the weakness.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"C\"\u003e\n                  \u003cxhtml:div\u003eprivate:\u003cxhtml:div style=\"margin-left:10px;\"\u003eint foo;\u003cxhtml:br/\u003ecomplexType bar;\u003cxhtml:br/\u003eString baz;\u003cxhtml:br/\u003eotherClass externalClass;\u003c/xhtml:div\u003e\n                     \u003cxhtml:br/\u003e\n                     \u003cxhtml:br/\u003epublic:\u003cxhtml:div style=\"margin-left:10px;\"\u003evoid doStuff() {\u003cxhtml:div style=\"margin-left:10px;\"\u003eexternalClass.doOtherStuff(foo, bar, baz)\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n                  \u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eIn this example, bar and baz will be passed by reference to doOtherStuff() which may change them.\u003c/Body_Text\u003e\n            "
    },
    {
      "text": "\n               \u003cIntro_Text\u003eIn the following Java example, the BookStore class manages the sale of books in a bookstore, this class includes the member objects for the bookstore inventory and sales database manager classes. The BookStore class includes a method for updating the sales database and inventory when a book is sold. This method retrieves a Book object from the bookstore inventory object using the supplied ISBN number for the book class, then calls a method for the sales object to update the sales information and then calls a method for the inventory object to update inventory for the BookStore.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"Java\"\u003e\n                  \u003cxhtml:div\u003epublic class BookStore {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                        \u003cxhtml:div\u003eprivate BookStoreInventory inventory;\u003cxhtml:br/\u003eprivate SalesDBManager sales;\u003cxhtml:br/\u003e...\u003cxhtml:br/\u003e\n                           \u003cxhtml:i\u003e// constructor for BookStore\u003c/xhtml:i\u003e\n                           \u003cxhtml:br/\u003epublic BookStore() {\u003cxhtml:div style=\"margin-left:10px;\"\u003ethis.inventory = new BookStoreInventory();\u003cxhtml:br/\u003ethis.sales = new SalesDBManager();\u003cxhtml:br/\u003e...\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003epublic void updateSalesAndInventoryForBookSold(String bookISBN) {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                              \u003cxhtml:div\u003e\n                                 \u003cxhtml:br/\u003e\n                                 \u003cxhtml:i\u003e// Get book object from inventory using ISBN\u003c/xhtml:i\u003e\n                                 \u003cxhtml:br/\u003eBook book = inventory.getBookWithISBN(bookISBN);\u003cxhtml:br/\u003e\n                                 \u003cxhtml:i\u003e// update sales information for book sold\u003c/xhtml:i\u003e\n                                 \u003cxhtml:br/\u003esales.updateSalesInformation(book);\u003cxhtml:br/\u003e\n                                 \u003cxhtml:i\u003e// update inventory\u003c/xhtml:i\u003e\n                                 \u003cxhtml:br/\u003einventory.updateInventory(book);\u003c/xhtml:div\u003e\n                           \u003c/xhtml:div\u003e}\u003cxhtml:br/\u003e\n                           \u003cxhtml:i\u003e// other BookStore methods\u003c/xhtml:i\u003e\n                           \u003cxhtml:br/\u003e...\u003c/xhtml:div\u003e\n                     \u003c/xhtml:div\u003e}\u003cxhtml:br/\u003epublic class Book {\u003cxhtml:div style=\"margin-left:10px;\"\u003eprivate String title;\u003cxhtml:br/\u003eprivate String author;\u003cxhtml:br/\u003eprivate String isbn;\u003cxhtml:br/\u003e\n                        \u003cxhtml:i\u003e// Book object constructors and get/set methods\u003c/xhtml:i\u003e\n                        \u003cxhtml:br/\u003e...\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eHowever, in this example the Book object that is retrieved and passed to the method of the sales object could have its contents modified by the method. This could cause unexpected results when the book object is sent to the method for the inventory object to update the inventory.\u003c/Body_Text\u003e\n               \u003cBody_Text\u003eIn the Java programming language arguments to methods are passed by value, however in the case of objects a reference to the object is passed by value to the method. When an object reference is passed as a method argument a copy of the object reference is made within the method and therefore both references point to the same object. This allows the contents of the object to be modified by the method that holds the copy of the object reference. [REF-374]\u003c/Body_Text\u003e\n               \u003cBody_Text\u003eIn this case the contents of the Book object could be modified by the method of the sales object prior to the call to update the inventory.\u003c/Body_Text\u003e\n               \u003cBody_Text\u003eTo prevent the contents of the Book object from being modified, a copy of the Book object should be made before the method call to the sales object. In the following example a copy of the Book object is made using the clone() method and the copy of the Book object is passed to the method of the sales object. This will prevent any changes being made to the original Book object.\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"good\" Language=\"Java\"\u003e\n                  \u003cxhtml:div\u003e...\u003cxhtml:br/\u003epublic void updateSalesAndInventoryForBookSold(String bookISBN) {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                        \u003cxhtml:div\u003e\n                           \u003cxhtml:br/\u003e\n                           \u003cxhtml:i\u003e// Get book object from inventory using ISBN\u003c/xhtml:i\u003e\n                           \u003cxhtml:br/\u003eBook book = inventory.getBookWithISBN(bookISBN);\u003cxhtml:br/\u003e\n                           \u003cxhtml:i\u003e// Create copy of book object to make sure contents are not changed\u003c/xhtml:i\u003e\n                           \u003cxhtml:br/\u003eBook bookSold = (Book) book.clone();\u003cxhtml:br/\u003e\n                           \u003cxhtml:i\u003e// update sales information for book sold\u003c/xhtml:i\u003e\n                           \u003cxhtml:br/\u003esales.updateSalesInformation(bookSold);\u003cxhtml:br/\u003e\n                           \u003cxhtml:i\u003e// update inventory\u003c/xhtml:i\u003e\n                           \u003cxhtml:br/\u003einventory.updateInventory(book);\u003c/xhtml:div\u003e\n                     \u003c/xhtml:div\u003e}\u003cxhtml:br/\u003e...\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n            "
    }
  ],
  "references": [
    {
      "reference_id": "REF-18",
      "author": [
        "Secure Software, Inc."
      ],
      "title": "The CLASP Application Security Process",
      "url": "https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf",
      "publication_year": "2005"
    },
    {
      "reference_id": "REF-374",
      "author": [
        "Tony Sintes"
      ],
      "title": "Does Java pass by reference or pass by value?",
      "url": "http://www.javaworld.com/javaworld/javaqa/2000-05/03-qa-0526-pass.html",
      "publication_year": "2000",
      "publication_month": "--05",
      "publication_day": "---26",
      "publication": "JavaWorld.com"
    },
    {
      "reference_id": "REF-375",
      "author": [
        "Herbert Schildt"
      ],
      "title": "Java: The Complete Reference, J2SE 5th Edition"
    }
  ],
  "content_history": {
    "submission": {
      "submission_name": "CLASP",
      "submission_date": "2006-07-19T00:00:00Z"
    },
    "modification": [
      {
        "modification_name": "Eric Dalci",
        "modification_organization": "Cigital",
        "modification_date": "2008-07-01T00:00:00Z",
        "modification_comment": "updated Time_of_Introduction"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-09-08T00:00:00Z",
        "modification_comment": "updated Applicable_Platforms, Common_Consequences, Relationships, Other_Notes, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2010-06-21T00:00:00Z",
        "modification_comment": "updated Name, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2010-12-13T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-06-01T00:00:00Z",
        "modification_comment": "updated Common_Consequences, Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-05-11T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-06-23T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples, Description, Other_Notes, Potential_Mitigations, References"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-07-30T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-11-08T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-01-03T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-02-24T00:00:00Z",
        "modification_comment": "updated References"
      }
    ],
    "previous_entry_name": [
      {
        "text": "Mutable Objects Passed by Reference",
        "date": "2010-06-21T00:00:00Z"
      }
    ]
  },
  "taxonomy_mappings": [
    {
      "taxonomy_name": "CLASP",
      "entry_name": "Passing mutable objects to an untrusted method"
    },
    {
      "taxonomy_name": "The CERT Oracle Secure Coding Standard for Java (2011)",
      "entry_name": "Provide mutable classes with copy functionality to safely allow passing instances to untrusted code",
      "entry_id": "OBJ04-J"
    },
    {
      "taxonomy_name": "Software Fault Patterns",
      "entry_name": "Exposed Data",
      "entry_id": "SFP23"
    }
  ]
}

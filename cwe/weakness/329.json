{
  "id": "329",
  "name": "Generation of Predictable IV with CBC Mode",
  "abstraction": "Variant",
  "structure": "Simple",
  "status": "Draft",
  "description": "The product generates and uses a predictable initialization Vector (IV) with Cipher Block Chaining (CBC) Mode, which causes algorithms to be susceptible to dictionary attacks when they are encrypted under the same key.",
  "extended_description": "\n\t   \u003cxhtml:p\u003eCBC mode eliminates a weakness of Electronic Code\n\t   Book (ECB) mode by allowing identical plaintext blocks to\n\t   be encrypted to different ciphertext blocks. This is\n\t   possible by the XOR-ing of an IV with the initial plaintext\n\t   block so that every plaintext block in the chain is XOR'd\n\t   with a different value before encryption. If IVs are\n\t   reused, then identical plaintexts would be encrypted to\n\t   identical ciphertexts. However, even if IVs are not\n\t   identical but are predictable, then they still break the\n\t   security of CBC mode against Chosen Plaintext Attacks\n\t   (CPA).\u003c/xhtml:p\u003e\n\t ",
  "related_weaknesses": [
    {
      "nature": "ChildOf",
      "cweid": "1204",
      "view_id": "1000",
      "ordinal": "Primary"
    },
    {
      "nature": "ChildOf",
      "cweid": "573",
      "view_id": "1000"
    }
  ],
  "applicable_platforms": {
    "language": [
      {
        "class": "Language-Independent",
        "prevalence": "Undetermined"
      }
    ]
  },
  "background_details": [
    "\n\t      \u003cxhtml:p\u003eCBC mode is a commonly used mode of operation for a\n\t      block cipher. It works by XOR-ing an IV with the initial\n\t      block of a plaintext prior to encryption and then\n\t      XOR-ing each successive block of plaintext with the\n\t      previous block of ciphertext before encryption.\u003c/xhtml:p\u003e\n\t      \u003cxhtml:div style=\"margin-left:10px;\"\u003e\n\t\tC_0 = IV\u003cxhtml:br/\u003e\n\t\tC_i = E_k{M_i XOR C_{i-1}}\n\t      \u003c/xhtml:div\u003e\n\t      \u003cxhtml:p\u003e\n\t\tWhen used properly, CBC mode provides security against\n\t\tchosen plaintext attacks. Having an unpredictable IV\n\t\tis a crucial underpinning of this. See [REF-1171].\u003c/xhtml:p\u003e\n\t      "
  ],
  "modes_of_introduction": [
    {
      "phase": "Architecture and Design",
      "note": [
        "Designers might assume a non-cryptographic context for a cryptographic variable."
      ]
    },
    {
      "phase": "Implementation",
      "note": [
        "Developers might dismiss the importance of an unpredictable IV and choose an easier implementation to save effort, weakening the scheme in the process."
      ]
    }
  ],
  "likelihood_of_exploit": "Medium",
  "common_consequences": [
    {
      "scope": [
        "Confidentiality"
      ],
      "impact": [
        "Read Application Data"
      ],
      "note": "If the IV is not properly initialized, data that is encrypted can be compromised and leak information."
    }
  ],
  "potential_mitigations": [
    {
      "phase": [
        "Implementation"
      ],
      "description": [
        "NIST recommends two methods of generating unpredictable IVs for CBC mode [REF-1172]. The first is to generate the IV randomly. The second method is to encrypt a nonce with the same key and cipher to be used to encrypt the plaintext. In this case the nonce must be unique but can be predictable, since the block cipher will act as a pseudo random permutation."
      ]
    }
  ],
  "demonstrative_examples": [
    {
      "demonstrative_example_id": "DX-143",
      "text": "\n               \u003cIntro_Text\u003eIn the following examples, CBC mode is used when encrypting data:\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"C\"\u003e\n                  \u003cxhtml:div\u003eEVP_CIPHER_CTX ctx;\u003cxhtml:br/\u003echar key[EVP_MAX_KEY_LENGTH];\u003cxhtml:br/\u003echar iv[EVP_MAX_IV_LENGTH];\u003cxhtml:br/\u003eRAND_bytes(key, b);\u003cxhtml:br/\u003ememset(iv,0,EVP_MAX_IV_LENGTH);\u003cxhtml:br/\u003eEVP_EncryptInit(\u0026amp;ctx,EVP_bf_cbc(), key,iv);\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"Java\"\u003e\n                  \u003cxhtml:div\u003epublic class SymmetricCipherTest {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                        \u003cxhtml:div\u003epublic static void main() {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                              \u003cxhtml:div\u003e\n                                 \u003cxhtml:br/\u003ebyte[] text =\"Secret\".getBytes();\u003cxhtml:br/\u003ebyte[] iv ={\u003cxhtml:div style=\"margin-left:10px;\"\u003e0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00\u003c/xhtml:div\u003e};\u003cxhtml:br/\u003eKeyGenerator kg = KeyGenerator.getInstance(\"DES\");\u003cxhtml:br/\u003ekg.init(56);\u003cxhtml:br/\u003eSecretKey key = kg.generateKey();\u003cxhtml:br/\u003eCipher cipher = Cipher.getInstance(\"DES/CBC/PKCS5Padding\");\u003cxhtml:br/\u003eIvParameterSpec ips = new IvParameterSpec(iv);\u003cxhtml:br/\u003ecipher.init(Cipher.ENCRYPT_MODE, key, ips);\u003cxhtml:br/\u003ereturn cipher.doFinal(inpBytes);\u003c/xhtml:div\u003e\n                           \u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n                     \u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eIn both of these examples, the initialization vector (IV) is always a block of zeros. This makes the resulting cipher text much more predictable and susceptible to a dictionary attack.\u003c/Body_Text\u003e\n            "
    }
  ],
  "observed_examples": [
    {
      "reference": "CVE-2020-5408",
      "description": "encryption functionality in an authentication framework uses a fixed null IV with CBC mode, allowing attackers to decrypt traffic in applications that use this functionality",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-5408"
    },
    {
      "reference": "CVE-2017-17704",
      "description": "messages for a door-unlocking product use a fixed IV in CBC mode, which is the same after each restart ",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-17704"
    },
    {
      "reference": "CVE-2017-11133",
      "description": "application uses AES in CBC mode, but the pseudo-random secret and IV are generated using math.random, which is not cryptographically strong.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11133"
    },
    {
      "reference": "CVE-2007-3528",
      "description": "Blowfish-CBC implementation constructs an IV where each byte is calculated modulo 8 instead of modulo 256, resulting in less than 12 bits for the effective IV length, and less than 4096 possible IV values.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-3528"
    },
    {
      "reference": "CVE-2011-3389",
      "description": "BEAST attack in SSL 3.0 / TLS 1.0. In CBC mode, chained initialization vectors are non-random, allowing decryption of HTTPS traffic using a chosen plaintext attack.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3389"
    }
  ],
  "references": [
    {
      "section": "Chapter 2, \"Initialization Vectors\", Page 42",
      "reference_id": "REF-62",
      "author": [
        "Mark Dowd",
        "John McDonald",
        "Justin Schuh"
      ],
      "title": "The Art of Software Security Assessment",
      "publication_year": "2006",
      "publisher": "Addison Wesley",
      "edition": "1st Edition"
    },
    {
      "reference_id": "REF-18",
      "author": [
        "Secure Software, Inc."
      ],
      "title": "The CLASP Application Security Process",
      "url": "https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf",
      "publication_year": "2005"
    },
    {
      "reference_id": "REF-1171",
      "author": [
        "Matthew Green"
      ],
      "title": "Why IND-CPA implies randomized encryption",
      "url": "https://blog.cryptographyengineering.com/why-ind-cpa-implies-randomized-encryption/",
      "publication_year": "2018",
      "publication_month": "--08",
      "publication_day": "---24"
    },
    {
      "section": "Appendix C",
      "reference_id": "REF-1172",
      "author": [
        "NIST"
      ],
      "title": "Recommendation for Block Cipher Modes of Operation",
      "url": "https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf",
      "publication_year": "2001",
      "publication_month": "--12"
    }
  ],
  "content_history": {
    "submission": {
      "submission_name": "CLASP",
      "submission_date": "2006-07-19T00:00:00Z"
    },
    "modification": [
      {
        "modification_name": "Eric Dalci",
        "modification_organization": "Cigital",
        "modification_date": "2008-07-01T00:00:00Z",
        "modification_comment": "updated Time_of_Introduction"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-09-08T00:00:00Z",
        "modification_comment": "updated Background_Details, Common_Consequences, Functional_Areas, Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-06-01T00:00:00Z",
        "modification_comment": "updated Common_Consequences"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-05-11T00:00:00Z",
        "modification_comment": "updated References, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-10-30T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples, Potential_Mitigations"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-07-30T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-11-08T00:00:00Z",
        "modification_comment": "updated Applicable_Platforms, Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-06-20T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-02-24T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-03-15T00:00:00Z",
        "modification_comment": "updated Background_Details, Common_Consequences, Demonstrative_Examples, Description, Modes_of_Introduction, Name, Observed_Examples, Potential_Mitigations, References, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-07-20T00:00:00Z",
        "modification_comment": "updated Description, Maintenance_Notes, Name, References"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-10-28T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2022-04-28T00:00:00Z",
        "modification_comment": "updated Relationships"
      }
    ],
    "previous_entry_name": [
      {
        "text": "Not Using a Random IV with CBC Mode",
        "date": "2021-03-15T00:00:00Z"
      },
      {
        "text": "Not Using an Unpredictable IV with CBC Mode",
        "date": "2021-07-20T00:00:00Z"
      }
    ]
  },
  "taxonomy_mappings": [
    {
      "taxonomy_name": "CLASP",
      "entry_name": "Not using a random IV with CBC mode"
    }
  ],
  "notes": [
    {
      "type": "Maintenance",
      "text": "As of CWE 4.5, terminology related to randomness, entropy, and\n\t   predictability can vary widely. Within the developer and other\n\t   communities, \"randomness\" is used heavily. However, within\n\t   cryptography, \"entropy\" is distinct, typically implied as a\n\t   measurement. There are no commonly-used definitions, even within\n\t   standards documents and cryptography papers. Future versions of\n\t   CWE will attempt to define these terms and, if necessary,\n\t   distinguish between them in ways that are appropriate for\n\t   different communities but do not reduce the usability of CWE for\n\t   mapping, understanding, or other scenarios."
    }
  ],
  "functional_areas": [
    "Cryptography"
  ]
}

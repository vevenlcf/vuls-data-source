{
  "id": "77",
  "name": "Improper Neutralization of Special Elements used in a Command ('Command Injection')",
  "abstraction": "Class",
  "structure": "Simple",
  "status": "Draft",
  "description": "The software constructs all or part of a command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended command when it is sent to a downstream component.",
  "extended_description": "\n            \u003cxhtml:p\u003eCommand injection vulnerabilities typically occur when:\u003c/xhtml:p\u003e\n            \u003cxhtml:div style=\"margin-left:10px;\"\u003e\n               \u003cxhtml:div\u003e1. Data enters the application from an untrusted source.\u003c/xhtml:div\u003e\n               \u003cxhtml:div\u003e2. The data is part of a string that is executed as a command by the application.\u003c/xhtml:div\u003e\n               \u003cxhtml:div\u003e3. By executing the command, the application gives an attacker a privilege or capability that the attacker would not otherwise have.\u003c/xhtml:div\u003e\n            \u003c/xhtml:div\u003e\n            \u003cxhtml:p\u003eMany protocols and products have their own custom command language. While OS or shell command strings are frequently discovered and targeted, developers may not realize that these other command languages might also be vulnerable to attacks.\u003c/xhtml:p\u003e\n            \u003cxhtml:p\u003eCommand injection is a common problem with wrapper programs.\u003c/xhtml:p\u003e\n         ",
  "related_weaknesses": [
    {
      "nature": "ChildOf",
      "cweid": "74",
      "view_id": "1000",
      "ordinal": "Primary"
    },
    {
      "nature": "ChildOf",
      "cweid": "74",
      "view_id": "1003",
      "ordinal": "Primary"
    }
  ],
  "applicable_platforms": {
    "language": [
      {
        "class": "Language-Independent",
        "prevalence": "Undetermined"
      }
    ]
  },
  "modes_of_introduction": [
    {
      "phase": "Architecture and Design"
    },
    {
      "phase": "Implementation",
      "note": [
        "REALIZATION: This weakness is caused during implementation of an architectural security tactic."
      ]
    }
  ],
  "likelihood_of_exploit": "High",
  "common_consequences": [
    {
      "scope": [
        "Integrity",
        "Confidentiality",
        "Availability"
      ],
      "impact": [
        "Execute Unauthorized Code or Commands"
      ],
      "note": "If a malicious user injects a character (such as a semi-colon) that delimits the end of one command and the beginning of another, it may be possible to then insert an entirely new and unrelated command that was not intended to be executed."
    }
  ],
  "potential_mitigations": [
    {
      "phase": [
        "Architecture and Design"
      ],
      "description": [
        "If at all possible, use library calls rather than external processes to recreate the desired functionality."
      ]
    },
    {
      "phase": [
        "Implementation"
      ],
      "description": [
        "If possible, ensure that all external commands called from the program are statically created."
      ]
    },
    {
      "mitigation_id": "MIT-5",
      "phase": [
        "Implementation"
      ],
      "description": [
        "\n                  \u003cxhtml:p\u003eAssume all input is malicious. Use an \"accept known good\" input validation strategy, i.e., use a list of acceptable inputs that strictly conform to specifications. Reject any input that does not strictly conform to specifications, or transform it into something that does.\u003c/xhtml:p\u003e\n                  \u003cxhtml:p\u003eWhen performing input validation, consider all potentially relevant properties, including length, type of input, the full range of acceptable values, missing or extra inputs, syntax, consistency across related fields, and conformance to business rules. As an example of business rule logic, \"boat\" may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as \"red\" or \"blue.\"\u003c/xhtml:p\u003e\n                  \u003cxhtml:p\u003eDo not rely exclusively on looking for malicious or malformed inputs.  This is likely to miss at least one undesirable input, especially if the code's environment changes. This can give attackers enough room to bypass the intended validation. However, denylists can be useful for detecting potential attacks or determining which inputs are so malformed that they should be rejected outright.\u003c/xhtml:p\u003e\n               "
      ],
      "strategy": "Input Validation"
    },
    {
      "phase": [
        "Operation"
      ],
      "description": [
        "Run time: Run time policy enforcement may be used in an allowlist fashion to prevent use of any non-sanctioned commands."
      ]
    },
    {
      "phase": [
        "System Configuration"
      ],
      "description": [
        "Assign permissions to the software system that prevents the user from accessing/opening privileged files."
      ]
    }
  ],
  "demonstrative_examples": [
    {
      "demonstrative_example_id": "DX-30",
      "text": "\n               \u003cIntro_Text\u003eThe following simple program accepts a filename as a command line argument and displays the contents of the file back to the user. The program is installed setuid root because it is intended for use as a learning tool to allow system administrators in-training to inspect privileged system files without giving them the ability to modify them or damage the system.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"C\"\u003e\n                  \u003cxhtml:div\u003eint main(int argc, char** argv) {\u003cxhtml:div style=\"margin-left:10px;\"\u003echar cmd[CMD_MAX] = \"/usr/bin/cat \";\u003cxhtml:br/\u003estrcat(cmd, argv[1]);\u003cxhtml:br/\u003esystem(cmd);\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eBecause the program runs with root privileges, the call to system() also executes with root privileges. If a user specifies a standard filename, the call works as expected. However, if an attacker passes a string of the form \";rm -rf /\", then the call to system() fails to execute cat due to a lack of arguments and then plows on to recursively delete the contents of the root partition.\u003c/Body_Text\u003e\n               \u003cBody_Text\u003eNote that if argv[1] is a very long argument, then this issue might also be subject to a buffer overflow (CWE-120).\u003c/Body_Text\u003e\n            "
    },
    {
      "demonstrative_example_id": "DX-28",
      "text": "\n               \u003cIntro_Text\u003eThe following code is from an administrative web application designed to allow users to kick off a backup of an Oracle database using a batch-file wrapper around the rman utility and then run a cleanup.bat script to delete some temporary files. The script rmanDB.bat accepts a single command line parameter, which specifies what type of backup to perform. Because access to the database is restricted, the application runs the backup as a privileged user.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"Java\"\u003e\n                  \u003cxhtml:div\u003e...\u003cxhtml:br/\u003eString btype = request.getParameter(\"backuptype\");\u003cxhtml:br/\u003eString cmd = new String(\"cmd.exe /K \\\"\u003cxhtml:div style=\"margin-left:10px;\"\u003ec:\\\\util\\\\rmanDB.bat \"\u003cxhtml:br/\u003e+btype+\u003cxhtml:br/\u003e\"\u0026amp;\u0026amp;c:\\\\utl\\\\cleanup.bat\\\"\")\u003c/xhtml:div\u003e\n                     \u003cxhtml:br/\u003eSystem.Runtime.getRuntime().exec(cmd);\u003cxhtml:br/\u003e...\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eThe problem here is that the program does not do any validation on the backuptype parameter read from the user. Typically the Runtime.exec() function will not execute multiple commands, but in this case the program first runs the cmd.exe shell in order to run multiple commands with a single call to Runtime.exec(). Once the shell is invoked, it will happily execute multiple commands separated by two ampersands. If an attacker passes a string of the form \"\u0026amp; del c:\\\\dbms\\\\*.*\", then the application will execute this command along with the others specified by the program. Because of the nature of the application, it runs with the privileges necessary to interact with the database, which means whatever command the attacker injects will run with those privileges as well.\u003c/Body_Text\u003e\n            "
    },
    {
      "text": "\n               \u003cIntro_Text\u003eThe following code from a system utility uses the system property APPHOME to determine the directory in which it is installed and then executes an initialization script based on a relative path from the specified directory.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"Java\"\u003e\n                  \u003cxhtml:div\u003e...\u003cxhtml:br/\u003eString home = System.getProperty(\"APPHOME\");\u003cxhtml:br/\u003eString cmd = home + INITCMD;\u003cxhtml:br/\u003ejava.lang.Runtime.getRuntime().exec(cmd);\u003cxhtml:br/\u003e...\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eThe code above allows an attacker to execute arbitrary commands with the elevated privilege of the application by modifying the system property APPHOME to point to a different path containing a malicious version of INITCMD. Because the program does not validate the value read from the environment, if an attacker can control the value of the system property APPHOME, then they can fool the application into running malicious code and take control of the system.\u003c/Body_Text\u003e\n            "
    },
    {
      "text": "\n               \u003cIntro_Text\u003eThe following code is a wrapper around the UNIX command cat which prints the contents of a file to standard out. It is also injectable:\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"C\"\u003e\n                  \u003cxhtml:div\u003e#include \u0026lt;stdio.h\u0026gt;\u003cxhtml:br/\u003e#include \u0026lt;unistd.h\u0026gt;\u003cxhtml:br/\u003e\n                     \u003cxhtml:br/\u003eint main(int argc, char **argv) {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                        \u003cxhtml:div\u003e\n                           \u003cxhtml:br/\u003echar cat[] = \"cat \";\u003cxhtml:br/\u003echar *command;\u003cxhtml:br/\u003esize_t commandLength;\u003cxhtml:br/\u003e\n                           \u003cxhtml:br/\u003ecommandLength = strlen(cat) + strlen(argv[1]) + 1;\u003cxhtml:br/\u003ecommand = (char *) malloc(commandLength);\u003cxhtml:br/\u003estrncpy(command, cat, commandLength);\u003cxhtml:br/\u003estrncat(command, argv[1], (commandLength - strlen(cat)) );\u003cxhtml:br/\u003e\n                           \u003cxhtml:br/\u003esystem(command);\u003cxhtml:br/\u003ereturn (0);\u003c/xhtml:div\u003e\n                     \u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eUsed normally, the output is simply the contents of the file requested:\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"informative\"\u003e\n                  \u003cxhtml:div\u003e$ ./catWrapper Story.txt\u003cxhtml:br/\u003eWhen last we left our heroes...\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eHowever, if we add a semicolon and another command to the end of this line, the command is executed by catWrapper with no complaint:\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"attack\"\u003e\n                  \u003cxhtml:div\u003e$ ./catWrapper Story.txt; ls\u003cxhtml:br/\u003eWhen last we left our heroes...\u003cxhtml:br/\u003eStory.txt\u003cxhtml:br/\u003eSensitiveFile.txt\u003cxhtml:br/\u003ePrivateData.db\u003cxhtml:br/\u003ea.out*\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eIf catWrapper had been set to have a higher privilege level than the standard user, arbitrary commands could be executed with that higher privilege.\u003c/Body_Text\u003e\n            "
    }
  ],
  "observed_examples": [
    {
      "reference": "CVE-1999-0067",
      "description": "Canonical example of OS command injection. CGI program does not neutralize \"|\" metacharacter when invoking a phonebook program.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0067"
    },
    {
      "reference": "CVE-2020-9054",
      "description": "Chain: improper input validation (CWE-20) in username parameter, leading to OS command injection (CWE-78), as exploited in the wild per CISA KEV.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-9054"
    },
    {
      "reference": "CVE-2022-1509",
      "description": "injection of sed script syntax (\"sed injection\")",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1509"
    },
    {
      "reference": "CVE-2021-41282",
      "description": "injection of sed script syntax (\"sed injection\")",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-41282"
    },
    {
      "reference": "CVE-2019-13398",
      "description": "injection of sed script syntax (\"sed injection\")",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13398"
    },
    {
      "reference": "CVE-2019-12921",
      "description": "image program allows injection of commands in \"Magick Vector Graphics (MVG)\" language.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12921"
    },
    {
      "reference": "CVE-2020-11698",
      "description": "anti-spam product allows injection of SNMP commands into confiuration file",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-11698"
    }
  ],
  "references": [
    {
      "reference_id": "REF-6",
      "author": [
        "Katrina Tsipenyuk",
        "Brian Chess",
        "Gary McGraw"
      ],
      "title": "Seven Pernicious Kingdoms: A Taxonomy of Software Security Errors",
      "url": "https://samate.nist.gov/SSATTM_Content/papers/Seven%20Pernicious%20Kingdoms%20-%20Taxonomy%20of%20Sw%20Security%20Errors%20-%20Tsipenyuk%20-%20Chess%20-%20McGraw.pdf",
      "publication_year": "2005",
      "publication_month": "--11",
      "publication_day": "---07",
      "publication": "NIST Workshop on Software Security Assurance Tools Techniques and Metrics",
      "publisher": "NIST"
    },
    {
      "reference_id": "REF-140",
      "author": [
        "Greg Hoglund",
        "Gary McGraw"
      ],
      "title": "Exploiting Software: How to Break Code",
      "url": "https://www.amazon.com/Exploiting-Software-How-Break-Code/dp/0201786958",
      "publication_year": "2004",
      "publication_month": "--02",
      "publication_day": "---27",
      "publisher": "Addison-Wesley"
    },
    {
      "section": "\"Sin 10: Command Injection.\" Page 171",
      "reference_id": "REF-44",
      "author": [
        "Michael Howard",
        "David LeBlanc",
        "John Viega"
      ],
      "title": "24 Deadly Sins of Software Security",
      "publication_year": "2010",
      "publication": "McGraw-Hill"
    }
  ],
  "content_history": {
    "submission": {
      "submission_name": "7 Pernicious Kingdoms",
      "submission_date": "2006-07-19T00:00:00Z"
    },
    "modification": [
      {
        "modification_name": "Eric Dalci",
        "modification_organization": "Cigital",
        "modification_date": "2008-07-01T00:00:00Z",
        "modification_comment": "updated Time_of_Introduction"
      },
      {
        "modification_organization": "Veracode",
        "modification_date": "2008-08-15T00:00:00Z",
        "modification_comment": "Suggested OWASP Top Ten 2004 mapping"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-09-08T00:00:00Z",
        "modification_comment": "updated Common_Consequences, Relationships, Other_Notes, Taxonomy_Mappings, Weakness_Ordinalities"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-05-27T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples, Name"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-07-27T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples, Description, Name"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-10-29T00:00:00Z",
        "modification_comment": "updated Common_Consequences, Description, Other_Notes, Potential_Mitigations"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2010-02-16T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2010-06-21T00:00:00Z",
        "modification_comment": "updated Description, Name"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-03-29T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-06-01T00:00:00Z",
        "modification_comment": "updated Common_Consequences"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-05-11T00:00:00Z",
        "modification_comment": "updated Common_Consequences, Demonstrative_Examples, References, Related_Attack_Patterns, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-10-30T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2013-02-21T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2013-07-17T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-02-18T00:00:00Z",
        "modification_comment": "updated Applicable_Platforms, Demonstrative_Examples, Description, Other_Notes, Terminology_Notes"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-06-23T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-07-30T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2015-12-07T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-05-03T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations, Related_Attack_Patterns, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-11-08T00:00:00Z",
        "modification_comment": "updated Causal_Nature, Likelihood_of_Exploit, Modes_of_Introduction, References, Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2018-03-27T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-01-03T00:00:00Z",
        "modification_comment": "updated Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-06-20T00:00:00Z",
        "modification_comment": "updated Related_Attack_Patterns, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-02-24T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations, References, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-06-25T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-08-20T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-12-10T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-03-15T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-07-20T00:00:00Z",
        "modification_comment": "updated Description, Observed_Examples, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-10-28T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2022-06-28T00:00:00Z",
        "modification_comment": "updated Observed_Examples, Relationships"
      }
    ],
    "previous_entry_name": [
      {
        "text": "Command Injection",
        "date": "2008-04-11T00:00:00Z"
      },
      {
        "text": "Failure to Sanitize Data into a Control Plane (aka 'Command Injection')",
        "date": "2009-05-27T00:00:00Z"
      },
      {
        "text": "Failure to Sanitize Data into a Control Plane ('Command Injection')",
        "date": "2009-07-27T00:00:00Z"
      },
      {
        "text": "Improper Sanitization of Special Elements used in a Command ('Command Injection')",
        "date": "2010-06-21T00:00:00Z"
      }
    ]
  },
  "weakness_ordinalities": [
    {
      "ordinality": "Primary"
    }
  ],
  "taxonomy_mappings": [
    {
      "taxonomy_name": "7 Pernicious Kingdoms",
      "entry_name": "Command Injection"
    },
    {
      "taxonomy_name": "CLASP",
      "entry_name": "Command injection"
    },
    {
      "taxonomy_name": "OWASP Top Ten 2007",
      "entry_name": "Injection Flaws",
      "entry_id": "A2",
      "mapping_fit": "CWE More Specific"
    },
    {
      "taxonomy_name": "OWASP Top Ten 2004",
      "entry_name": "Unvalidated Input",
      "entry_id": "A1",
      "mapping_fit": "CWE More Specific"
    },
    {
      "taxonomy_name": "OWASP Top Ten 2004",
      "entry_name": "Injection Flaws",
      "entry_id": "A6",
      "mapping_fit": "CWE More Specific"
    },
    {
      "taxonomy_name": "Software Fault Patterns",
      "entry_name": "Tainted input to command",
      "entry_id": "SFP24"
    },
    {
      "taxonomy_name": "SEI CERT Perl Coding Standard",
      "entry_name": "Do not pass untrusted, unsanitized data to a command interpreter",
      "entry_id": "IDS34-PL",
      "mapping_fit": "CWE More Specific"
    }
  ],
  "related_attack_patterns": [
    "136",
    "15",
    "183",
    "248",
    "40",
    "43",
    "75",
    "76"
  ],
  "notes": [
    {
      "type": "Terminology",
      "text": "\n               \u003cxhtml:p\u003eThe \"command injection\" phrase carries different meanings to different people. For some people, it refers to refers to any type of attack that can allow the attacker to execute commands of their own choosing, regardless of how those commands are inserted. The command injection could thus be resultant from another weakness. This usage also includes cases in which the functionality allows the user to specify an entire command, which is then executed; within CWE, this situation might be better regarded as an authorization problem (since an attacker should not be able to specify arbitrary commands.)\u003c/xhtml:p\u003e\n               \u003cxhtml:p\u003eAnother common usage, which includes CWE-77 and its descendants, involves cases in which the attacker injects separators into the command being constructed.\u003c/xhtml:p\u003e\n            "
    }
  ]
}

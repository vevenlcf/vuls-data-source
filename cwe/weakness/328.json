{
  "id": "328",
  "name": "Use of Weak Hash",
  "abstraction": "Base",
  "structure": "Simple",
  "status": "Draft",
  "description": "The product uses an algorithm that produces a digest (output value) that does not meet security expectations for a hash function that allows an adversary to reasonably determine the original input (preimage attack), find another input that can produce the same hash (2nd preimage attack), or find multiple inputs that evaluate to the same hash (birthday attack).",
  "extended_description": "\n\t   \u003cxhtml:p\u003eA hash function is defined as an algorithm that maps arbitrarily sized data into a fixed-sized digest (output) such that the following properties hold:\u003c/xhtml:p\u003e\n\t   \u003cxhtml:ul\u003e\n\t     \u003cxhtml:li\u003e1. The algorithm is not invertible (also called \"one-way\" or \"not reversible\")\u003c/xhtml:li\u003e\n\t     \u003cxhtml:li\u003e2. The algorithm is deterministic; the same input produces the same digest every time\u003c/xhtml:li\u003e\n\t   \u003c/xhtml:ul\u003e\n\t   \u003cxhtml:p\u003e\n\t     Building on this definition, a cryptographic hash function must also ensure that a malicious actor cannot leverage the hash function to have a reasonable chance of success at determining any of the following:\u003c/xhtml:p\u003e\n\t   \u003cxhtml:ul\u003e\n\t     \u003cxhtml:li\u003e1. the original input (preimage attack), given only the digest\u003c/xhtml:li\u003e\n\t     \u003cxhtml:li\u003e2. another input that can produce the same digest (2nd preimage attack), given the original input\u003c/xhtml:li\u003e\n\t     \u003cxhtml:li\u003e3. a set of two or more inputs that evaluate to the same digest (birthday attack), given the actor can arbitrarily choose the inputs to be hashed and can do so a reasonable amount of times\u003c/xhtml:li\u003e\n\t   \u003c/xhtml:ul\u003e\n\t   \u003cxhtml:p\u003eWhat is regarded as \"reasonable\" varies by context and threat model, but in general, \"reasonable\" could cover any attack that is more efficient than brute force (i.e., on average, attempting half of all possible combinations). Note that some attacks might be more efficient than brute force but are still not regarded as achievable in the real world.\u003c/xhtml:p\u003e\n\t   \u003cxhtml:p\u003eAny algorithm does not meet the above conditions will generally be considered weak for general use in hashing.\u003c/xhtml:p\u003e\n\t   \u003cxhtml:p\u003eIn addition to algorithmic weaknesses, a hash function can be made weak by using the hash in a security context that breaks its security guarantees. For example, using a hash function without a salt for storing passwords (that are sufficiently short) could enable an adversary to create a \"rainbow table\" [REF-637] to recover the password under certain conditions; this attack works against such hash functions as MD5, SHA-1, and SHA-2.\u003c/xhtml:p\u003e\n\t ",
  "related_weaknesses": [
    {
      "nature": "ChildOf",
      "cweid": "326",
      "view_id": "1000"
    },
    {
      "nature": "ChildOf",
      "cweid": "327",
      "view_id": "1000",
      "ordinal": "Primary"
    }
  ],
  "applicable_platforms": {
    "language": [
      {
        "class": "Language-Independent",
        "prevalence": "Undetermined"
      }
    ]
  },
  "modes_of_introduction": [
    {
      "phase": "Architecture and Design",
      "note": [
        "COMMISSION: This weakness refers to an incorrect design related to an architectural security tactic."
      ]
    }
  ],
  "common_consequences": [
    {
      "scope": [
        "Access Control"
      ],
      "impact": [
        "Bypass Protection Mechanism"
      ]
    }
  ],
  "potential_mitigations": [
    {
      "mitigation_id": "MIT-51",
      "phase": [
        "Architecture and Design"
      ],
      "description": [
        "\n                  \u003cxhtml:p\u003eUse an adaptive hash function that can be configured to change the amount of computational effort needed to compute the hash, such as the number of iterations (\"stretching\") or the amount of memory required. Some hash functions perform salting automatically. These functions can significantly increase the overhead for a brute force attack compared to intentionally-fast functions such as MD5. For example, rainbow table attacks can become infeasible due to the high computing overhead. Finally, since computing power gets faster and cheaper over time, the technique can be reconfigured to increase the workload without forcing an entire replacement of the algorithm in use.\u003c/xhtml:p\u003e\n                  \u003cxhtml:p\u003eSome hash functions that have one or more of these desired properties include bcrypt [REF-291], scrypt [REF-292], and PBKDF2 [REF-293]. While there is active debate about which of these is the most effective, they are all stronger than using salts with hash functions with very little computing overhead.\u003c/xhtml:p\u003e\n                  \u003cxhtml:p\u003eNote that using these functions can have an impact on performance, so they require special consideration to avoid denial-of-service attacks. However, their configurability provides finer control over how much CPU and memory is used, so it could be adjusted to suit the environment's needs.\u003c/xhtml:p\u003e\n               "
      ],
      "effectiveness": "High"
    }
  ],
  "demonstrative_examples": [
    {
      "demonstrative_example_id": "DX-101",
      "text": "\n               \u003cIntro_Text\u003eIn both of these examples, a user is logged in if their given password matches a stored password:\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"C\"\u003e\n                  \u003cxhtml:div\u003eunsigned char *check_passwd(char *plaintext) {\u003cxhtml:div style=\"margin-left:10px;\"\u003ectext = simple_digest(\"sha1\",plaintext,strlen(plaintext), ... );\u003cxhtml:br/\u003e\n                        \u003cxhtml:i\u003e//Login if hash matches stored hash\u003c/xhtml:i\u003e\n                        \u003cxhtml:br/\u003eif (equal(ctext, secret_password())) {\u003cxhtml:div style=\"margin-left:10px;\"\u003elogin_user();\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"Java\"\u003e\n                  \u003cxhtml:div\u003eString plainText = new String(plainTextIn);\u003cxhtml:br/\u003eMessageDigest encer = MessageDigest.getInstance(\"SHA\");\u003cxhtml:br/\u003eencer.update(plainTextIn);\u003cxhtml:br/\u003ebyte[] digest = password.digest();\u003cxhtml:br/\u003e\n                     \u003cxhtml:i\u003e//Login if hash matches stored hash\u003c/xhtml:i\u003e\n                     \u003cxhtml:br/\u003eif (equal(digest,secret_password())) {\u003cxhtml:div style=\"margin-left:10px;\"\u003elogin_user();\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eThis code relies exclusively on a password mechanism (CWE-309) using only one factor of authentication (CWE-308). If an attacker can steal or guess a user's password, they are given full access to their account. Note this code also uses SHA-1, which is a weak hash (CWE-328).  It also does not use a salt (CWE-759).\u003c/Body_Text\u003e\n            "
    }
  ],
  "observed_examples": [
    {
      "reference": "CVE-2005-4900",
      "description": "SHA-1 algorithm is not collision-resistant.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-4900"
    },
    {
      "reference": "CVE-2020-25685",
      "description": "DNS product uses a weak hash (CRC32 or SHA-1) of the query name, allowing attacker to forge responses by computing domain names with the same hash.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-25685"
    },
    {
      "reference": "CVE-2012-6707",
      "description": "blogging product uses MD5-based algorithm for passwords.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-6707"
    },
    {
      "reference": "CVE-2019-14855",
      "description": "forging of certificate signatures using SHA-1 collisions.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-14855"
    },
    {
      "reference": "CVE-2017-15999",
      "description": "mobile app for backup sends SHA-1 hash of password in cleartext.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-15999"
    },
    {
      "reference": "CVE-2006-4068",
      "description": "Hard-coded hashed values for username and password contained in client-side script, allowing brute-force offline attacks.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-4068"
    }
  ],
  "references": [
    {
      "reference_id": "REF-289",
      "author": [
        "Alexander Sotirov et al."
      ],
      "title": "MD5 considered harmful today",
      "url": "http://www.phreedom.org/research/rogue-ca/"
    },
    {
      "section": "Chapter 2, \"Common Vulnerabilities of Integrity\", Page 47",
      "reference_id": "REF-62",
      "author": [
        "Mark Dowd",
        "John McDonald",
        "Justin Schuh"
      ],
      "title": "The Art of Software Security Assessment",
      "publication_year": "2006",
      "publisher": "Addison Wesley",
      "edition": "1st Edition"
    },
    {
      "reference_id": "REF-291",
      "author": [
        "Johnny Shelley"
      ],
      "title": "bcrypt",
      "url": "http://bcrypt.sourceforge.net/"
    },
    {
      "reference_id": "REF-292",
      "author": [
        "Colin Percival"
      ],
      "title": "Tarsnap - The scrypt key derivation function and encryption utility",
      "url": "http://www.tarsnap.com/scrypt.html"
    },
    {
      "section": "5.2 PBKDF2",
      "reference_id": "REF-293",
      "author": [
        "B. Kaliski"
      ],
      "title": "RFC2898 - PKCS #5: Password-Based Cryptography Specification Version 2.0",
      "url": "http://tools.ietf.org/html/rfc2898",
      "publication_year": "2000"
    },
    {
      "reference_id": "REF-294",
      "author": [
        "Coda Hale"
      ],
      "title": "How To Safely Store A Password",
      "url": "http://codahale.com/how-to-safely-store-a-password/",
      "publication_year": "2010",
      "publication_month": "--01",
      "publication_day": "---31"
    },
    {
      "reference_id": "REF-295",
      "author": [
        "Brian Krebs"
      ],
      "title": "How Companies Can Beef Up Password Security (interview with Thomas H. Ptacek)",
      "url": "http://krebsonsecurity.com/2012/06/how-companies-can-beef-up-password-security/",
      "publication_year": "2012",
      "publication_month": "--06",
      "publication_day": "---11"
    },
    {
      "reference_id": "REF-296",
      "author": [
        "Solar Designer"
      ],
      "title": "Password security: past, present, future",
      "url": "http://www.openwall.com/presentations/PHDays2012-Password-Security/",
      "publication_year": "2012"
    },
    {
      "reference_id": "REF-297",
      "author": [
        "Troy Hunt"
      ],
      "title": "Our password hashing has no clothes",
      "url": "http://www.troyhunt.com/2012/06/our-password-hashing-has-no-clothes.html",
      "publication_year": "2012",
      "publication_month": "--06",
      "publication_day": "---26"
    },
    {
      "reference_id": "REF-298",
      "author": [
        "Joshbw"
      ],
      "title": "Should we really use bcrypt/scrypt?",
      "url": "http://www.analyticalengine.net/2012/06/should-we-really-use-bcryptscrypt/",
      "publication_year": "2012",
      "publication_month": "--06",
      "publication_day": "---08"
    },
    {
      "reference_id": "REF-637",
      "title": "Rainbow table",
      "url": "http://en.wikipedia.org/wiki/Rainbow_table",
      "publication_year": "2009",
      "publication_month": "--03",
      "publication_day": "---03",
      "publisher": "Wikipedia"
    },
    {
      "reference_id": "REF-1243",
      "author": [
        "Bruce Schneier"
      ],
      "title": "Cryptanalysis of SHA-1",
      "url": "https://www.schneier.com/blog/archives/2005/02/cryptanalysis_o.html",
      "publication_year": "2005",
      "publication_month": "--02",
      "publication_day": "---18",
      "url_date": "2021-10-25"
    },
    {
      "reference_id": "REF-1244",
      "author": [
        "Dan Goodin"
      ],
      "title": "At death's door for years, widely used SHA1 function is now dead",
      "url": "https://arstechnica.com/information-technology/2017/02/at-deaths-door-for-years-widely-used-sha1-function-is-now-dead/",
      "publication_year": "2017",
      "publication_month": "--02",
      "publication_day": "---23",
      "publisher": "Ars Technica",
      "url_date": "2021-10-25"
    }
  ],
  "content_history": {
    "submission": {
      "submission_name": "PLOVER",
      "submission_date": "2006-07-19T00:00:00Z"
    },
    "modification": [
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-09-08T00:00:00Z",
        "modification_comment": "updated Relationships, Observed_Example, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-10-14T00:00:00Z",
        "modification_comment": "updated Description"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-01-12T00:00:00Z",
        "modification_comment": "updated Description, References"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-10-29T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-06-01T00:00:00Z",
        "modification_comment": "updated Common_Consequences"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-05-11T00:00:00Z",
        "modification_comment": "updated References, Related_Attack_Patterns, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-10-30T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples, Potential_Mitigations, References"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-02-18T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations, References"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-06-23T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-07-30T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-11-08T00:00:00Z",
        "modification_comment": "updated Applicable_Platforms, Modes_of_Introduction, References, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2018-03-27T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-03-15T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-10-28T00:00:00Z",
        "modification_comment": "updated Description, Maintenance_Notes, Name, Observed_Examples, References, Relationships"
      }
    ],
    "previous_entry_name": [
      {
        "text": "Reversible One-Way Hash",
        "date": "2021-10-28T00:00:00Z"
      }
    ]
  },
  "taxonomy_mappings": [
    {
      "taxonomy_name": "PLOVER",
      "entry_name": "Reversible One-Way Hash"
    }
  ],
  "related_attack_patterns": [
    "461",
    "68"
  ],
  "notes": [
    {
      "type": "Maintenance",
      "text": "Since CWE 4.4, various cryptography-related entries including CWE-328 have been slated for extensive research, analysis, and community consultation to define consistent terminology, improve relationships, and reduce overlap or duplication. As of CWE 4.6, this work is still ongoing."
    }
  ]
}

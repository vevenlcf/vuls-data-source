{
  "id": "1022",
  "name": "Use of Web Link to Untrusted Target with window.opener Access",
  "abstraction": "Variant",
  "structure": "Simple",
  "status": "Incomplete",
  "description": "The web application produces links to untrusted external sites outside of its sphere of control, but it does not properly prevent the external site from modifying  security-critical properties of the window.opener object, such as the location property.",
  "extended_description": "When a user clicks a link to an external site (\"target\"), the target=\"_blank\" attribute causes the target site's contents to be opened in a new window or tab, which runs in the same process as the original page. The window.opener object records information about the original page that offered the link.  If an attacker can run script on the target page, then they could read or modify certain properties of the window.opener object, including the location property - even if the original and target site are not the same origin.  An attacker can modify the location property to automatically redirect the user to a malicious site, e.g. as part of a phishing attack. Since this redirect happens in the original window/tab - which is not necessarily visible, since the browser is focusing the display on the new target page - the user might not notice any suspicious redirection.",
  "related_weaknesses": [
    {
      "nature": "ChildOf",
      "cweid": "266",
      "view_id": "1000",
      "ordinal": "Primary"
    }
  ],
  "applicable_platforms": {
    "language": [
      {
        "prevalence": "Often",
        "name": "JavaScript"
      }
    ],
    "technology": [
      {
        "class": "Web Based",
        "prevalence": "Often"
      }
    ]
  },
  "modes_of_introduction": [
    {
      "phase": "Architecture and Design",
      "note": [
        "This weakness is introduced during the design of an application when the architect does not specify that a linked external document should not be able to alter the location of the calling page."
      ]
    },
    {
      "phase": "Implementation",
      "note": [
        "This weakness is introduced during the coding of an application when the developer does not include the noopener and/or noreferrer value for the rel attribute."
      ]
    }
  ],
  "likelihood_of_exploit": "Medium",
  "common_consequences": [
    {
      "scope": [
        "Confidentiality"
      ],
      "impact": [
        "Alter Execution Logic"
      ],
      "note": "The user may be redirected to an untrusted page that contains undesired content or malicious script code."
    }
  ],
  "potential_mitigations": [
    {
      "phase": [
        "Architecture and Design"
      ],
      "description": [
        "Specify in the design that any linked external document must not be granted access to the location object of the calling page."
      ]
    },
    {
      "phase": [
        "Implementation"
      ],
      "description": [
        "\n                  \u003cxhtml:p\u003eWhen creating a link to an external document using the \u0026lt;a\u0026gt; tag with a defined target, for example \"_blank\" or a named frame, provide the rel attribute with a value \"noopener noreferrer\".\u003c/xhtml:p\u003e\n                  \u003cxhtml:p\u003eIf opening the external document in a new window via javascript, then reset the opener by setting it equal to null.\u003c/xhtml:p\u003e\n               "
      ]
    },
    {
      "phase": [
        "Implementation"
      ],
      "description": [
        "\n                  \u003cxhtml:p\u003eDo not use \"_blank\" targets. However, this can affect the usability of the application.\u003c/xhtml:p\u003e\n               "
      ]
    }
  ],
  "demonstrative_examples": [
    {
      "text": "\n               \u003cIntro_Text\u003eIn this example, the application opens a link in a named window/tab without taking precautions to prevent the called page from tampering with the calling page's location in the browser.\u003c/Intro_Text\u003e\n               \u003cBody_Text\u003eThere are two ways that this weakness is commonly seen. The first is when the application generates an \u0026lt;a\u0026gt; tag is with target=\"_blank\" to point to a target site:\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"HTML\"\u003e\n                  \u003cxhtml:div\u003e\u0026lt;a href=\"http://attacker-site.example.com/useful-page.html\" target=\"_blank\"\u0026gt;\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eIf the attacker offers a useful page on this link (or compromises a trusted, popular site), then a user may click on this link.  However, the attacker could use scripting code to modify the window.opener's location property to redirect the application to a malicious, attacker-controlled page - such as one that mimics the look and feel of the original application and convinces the user to re-enter authentication credentials, i.e. phishing:\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"attack\" Language=\"JavaScript\"\u003e\n                  \u003cxhtml:div\u003ewindow.opener.location = 'http://phishing.example.org/popular-bank-page';\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eTo mitigate this type of weakness, some browsers support the \"rel\" attribute with a value of \"noopener\", which sets the window.opener object equal to null. Another option is to use the \"rel\" attribute with a value of \"noreferrer\", which in essence does the same thing.\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"good\" Language=\"HTML\"\u003e\n                  \u003cxhtml:div\u003e\u0026lt;a href=\"http://attacker-site.example.com/useful-page.html\" target=\"_blank\" rel=\"noopener noreferrer\"\u0026gt;\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eA second way that this weakness is commonly seen is when opening a new site directly within JavaScript. In this case, a new site is opened using the window.open() function.\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"JavaScript\"\u003e\n                  \u003cxhtml:div\u003evar newWindow = window.open(\"http://attacker-site.example.com/useful-page.html\", \"_blank\");\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eTo mitigate this, set the window.opener object to null.\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"good\" Language=\"JavaScript\"\u003e\n                  \u003cxhtml:div\u003evar newWindow = window.open(\"http://attacker-site.example.com/useful-page.html\", \"_blank\");\u003cxhtml:br/\u003enewWindow.opener = null;\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n            "
    }
  ],
  "references": [
    {
      "reference_id": "REF-39",
      "author": [
        "Alex Yumashev"
      ],
      "title": "Target=\"_blank\" - the most underestimated vulnerability ever",
      "url": "https://medium.com/@jitbit/target-blank-the-most-underestimated-vulnerability-ever-96e328301f4c",
      "publication_year": "2016",
      "publication_month": "--05",
      "publication_day": "---04"
    },
    {
      "reference_id": "REF-40",
      "author": [
        "Ben Halpern"
      ],
      "title": "The target=\"_blank\" vulnerability by example",
      "url": "https://dev.to/ben/the-targetblank-vulnerability-by-example",
      "publication_year": "2016",
      "publication_month": "--09",
      "publication_day": "---11"
    },
    {
      "reference_id": "REF-958",
      "author": [
        "Mathias Bynens"
      ],
      "title": "About rel=noopener",
      "url": "https://mathiasbynens.github.io/rel-noopener/",
      "publication_year": "2016",
      "publication_month": "--03",
      "publication_day": "---15"
    }
  ],
  "content_history": {
    "submission": {
      "submission_name": "David Deatherage",
      "submission_organization": "Silicon Valley Bank",
      "submission_date": "2017-09-26T00:00:00Z"
    },
    "modification": [
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2018-03-27T00:00:00Z",
        "modification_comment": "updated Alternate_Terms, Demonstrative_Examples, Description, Modes_of_Introduction, Name, Potential_Mitigations, References"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-02-24T00:00:00Z",
        "modification_comment": "updated Applicable_Platforms, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-07-20T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations"
      }
    ],
    "previous_entry_name": [
      {
        "text": "Improper Restriction of Cross-Origin Permission to window.opener.location",
        "date": "2018-03-27T00:00:00Z"
      }
    ]
  },
  "alternate_terms": [
    {
      "term": "tabnabbing"
    }
  ]
}

{
  "id": "697",
  "name": "Incorrect Comparison",
  "abstraction": "Pillar",
  "structure": "Simple",
  "status": "Incomplete",
  "description": "The software compares two entities in a security-relevant context, but the comparison is incorrect, which may lead to resultant weaknesses.",
  "extended_description": "\n            \u003cxhtml:p\u003eThis weakness class covers several possibilities:\u003c/xhtml:p\u003e\n            \u003cxhtml:div style=\"margin-left:10px;\"\u003e\n               \u003cxhtml:ol\u003e\n                  \u003cxhtml:li\u003ethe comparison checks one factor incorrectly;\u003c/xhtml:li\u003e\n                  \u003cxhtml:li\u003ethe comparison should consider multiple factors, but it does not check some of those factors at all;\u003c/xhtml:li\u003e\n                  \u003cxhtml:li\u003ethe comparison checks the wrong factor.\u003c/xhtml:li\u003e\n               \u003c/xhtml:ol\u003e\n            \u003c/xhtml:div\u003e\n         ",
  "applicable_platforms": {
    "language": [
      {
        "class": "Language-Independent",
        "prevalence": "Undetermined"
      }
    ],
    "technology": [
      {
        "class": "Technology-Independent",
        "prevalence": "Undetermined"
      }
    ]
  },
  "modes_of_introduction": [
    {
      "phase": "Implementation"
    }
  ],
  "common_consequences": [
    {
      "scope": [
        "Other"
      ],
      "impact": [
        "Varies by Context"
      ]
    }
  ],
  "demonstrative_examples": [
    {
      "demonstrative_example_id": "DX-115",
      "text": "\n               \u003cIntro_Text\u003eConsider an application in which Truck objects are defined to be the same if they have the same make, the same model, and were manufactured in the same year.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"Java\"\u003e\n                  \u003cxhtml:div\u003epublic class Truck {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                        \u003cxhtml:div\u003eprivate String make;\u003cxhtml:br/\u003eprivate String model;\u003cxhtml:br/\u003eprivate int year;\u003cxhtml:br/\u003e\n                           \u003cxhtml:br/\u003epublic boolean equals(Object o) {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                              \u003cxhtml:div\u003eif (o == null) return false;\u003cxhtml:br/\u003eif (o == this) return true;\u003cxhtml:br/\u003eif (!(o instanceof Truck)) return false;\u003cxhtml:br/\u003e\n                                 \u003cxhtml:br/\u003eTruck t = (Truck) o;\u003cxhtml:br/\u003e\n                                 \u003cxhtml:br/\u003ereturn (this.make.equals(t.getMake()) \u0026amp;\u0026amp; this.model.equals(t.getModel()));\u003c/xhtml:div\u003e\n                           \u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n                     \u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eHere, the equals() method only checks the make and model of the Truck objects, but the year of manufacture is not included.\u003c/Body_Text\u003e\n            "
    },
    {
      "demonstrative_example_id": "DX-116",
      "text": "\n               \u003cIntro_Text\u003eThis example defines a fixed username and password. The AuthenticateUser() function is intended to accept a username and a password from an untrusted user, and check to ensure that it matches the username and password. If the username and password match, AuthenticateUser() is intended to indicate that authentication succeeded.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"C\"\u003e\n                  \u003cxhtml:div\u003e\n                     \u003cxhtml:i\u003e/* Ignore CWE-259 (hard-coded password) and CWE-309 (use of password system for authentication) for this example. */\u003c/xhtml:i\u003e\n                     \u003cxhtml:br/\u003e\n                     \u003cxhtml:br/\u003echar *username = \"admin\";\u003cxhtml:br/\u003echar *pass = \"password\";\u003cxhtml:br/\u003e\n                     \u003cxhtml:br/\u003eint AuthenticateUser(char *inUser, char *inPass) {\u003cxhtml:div style=\"margin-left:10px;\"\u003eif (strncmp(username, inUser, strlen(inUser))) {\u003cxhtml:div style=\"margin-left:10px;\"\u003elogEvent(\"Auth failure of username using strlen of inUser\");\u003cxhtml:br/\u003ereturn(AUTH_FAIL);\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003eif (! strncmp(pass, inPass, strlen(inPass))) {\u003cxhtml:div style=\"margin-left:10px;\"\u003elogEvent(\"Auth success of password using strlen of inUser\");\u003cxhtml:br/\u003ereturn(AUTH_SUCCESS);\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003eelse {\u003cxhtml:div style=\"margin-left:10px;\"\u003elogEvent(\"Auth fail of password using sizeof\");\u003cxhtml:br/\u003ereturn(AUTH_FAIL);\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003e\n                     \u003cxhtml:br/\u003eint main (int argc, char **argv) {\u003cxhtml:div style=\"margin-left:10px;\"\u003e\n                     int authResult;\u003cxhtml:br/\u003e\u003cxhtml:br/\u003eif (argc \u0026lt; 3) {\u003cxhtml:div style=\"margin-left:10px;\"\u003eExitError(\"Usage: Provide a username and password\");\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003eauthResult = AuthenticateUser(argv[1], argv[2]);\u003cxhtml:br/\u003eif (authResult == AUTH_SUCCESS) {\u003cxhtml:div style=\"margin-left:10px;\"\u003eDoAuthenticatedTask(argv[1]);\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003eelse {\u003cxhtml:div style=\"margin-left:10px;\"\u003eExitError(\"Authentication failed\");\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eIn AuthenticateUser(), the strncmp() call uses the string length of an attacker-provided inPass parameter in order to determine how many characters to check in the password. So, if the attacker only provides a password of length 1, the check will only examine the first byte of the application's password before determining success.\u003c/Body_Text\u003e\n               \u003cBody_Text\u003eAs a result, this partial comparison leads to improper authentication (CWE-287).\u003c/Body_Text\u003e\n               \u003cBody_Text\u003eAny of these passwords would still cause authentication to succeed for the \"admin\" user:\u003c/Body_Text\u003e\n               \u003cExample_Code Nature=\"attack\"\u003e\n                  \u003cxhtml:div\u003ep\u003cxhtml:br/\u003epa\u003cxhtml:br/\u003epas\u003cxhtml:br/\u003epass\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eThis significantly reduces the search space for an attacker, making brute force attacks more feasible.\u003c/Body_Text\u003e\n               \u003cBody_Text\u003eThe same problem also applies to the username, so values such as \"a\" and \"adm\" will succeed for the username.\u003c/Body_Text\u003e\n               \u003cBody_Text\u003eWhile this demonstrative example may not seem realistic, see the Observed Examples for CVE entries that effectively reflect this same weakness.\u003c/Body_Text\u003e\n            "
    }
  ],
  "observed_examples": [
    {
      "reference": "CVE-2020-15811",
      "description": "Chain: Proxy uses a substring search instead of parsing the Transfer-Encoding header (CWE-697), allowing request splitting (CWE-113) and cache poisoning",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15811"
    },
    {
      "reference": "CVE-2016-10003",
      "description": "Proxy performs incorrect comparison of request headers, leading to infoleak",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-10003"
    }
  ],
  "content_history": {
    "submission": {
      "submission_name": "CWE Content Team",
      "submission_organization": "MITRE",
      "submission_date": "2008-09-09T00:00:00Z"
    },
    "modification": [
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-11-24T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-03-10T00:00:00Z",
        "modification_comment": "updated Related_Attack_Patterns"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-05-27T00:00:00Z",
        "modification_comment": "updated Description"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-03-29T00:00:00Z",
        "modification_comment": "updated Description"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-06-01T00:00:00Z",
        "modification_comment": "updated Common_Consequences"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-09-13T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-05-11T00:00:00Z",
        "modification_comment": "updated Related_Attack_Patterns, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-07-30T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-05-03T00:00:00Z",
        "modification_comment": "updated Related_Attack_Patterns"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-11-08T00:00:00Z",
        "modification_comment": "updated Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2018-03-27T00:00:00Z",
        "modification_comment": "updated Common_Consequences, Demonstrative_Examples, Description, Maintenance_Notes, Name, Observed_Examples, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-01-03T00:00:00Z",
        "modification_comment": "updated Related_Attack_Patterns, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-06-20T00:00:00Z",
        "modification_comment": "updated Related_Attack_Patterns"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-09-19T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-02-24T00:00:00Z",
        "modification_comment": "updated Applicable_Platforms, Relationships, Type"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-06-25T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-08-20T00:00:00Z",
        "modification_comment": "updated Related_Attack_Patterns"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2022-04-28T00:00:00Z",
        "modification_comment": "updated Related_Attack_Patterns"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2022-06-28T00:00:00Z",
        "modification_comment": "updated Observed_Examples"
      }
    ],
    "previous_entry_name": [
      {
        "text": "Insufficient Comparison",
        "date": "2018-03-27T00:00:00Z"
      }
    ]
  },
  "weakness_ordinalities": [
    {
      "ordinality": "Primary"
    }
  ],
  "related_attack_patterns": [
    "10",
    "120",
    "14",
    "15",
    "182",
    "24",
    "267",
    "3",
    "41",
    "43",
    "44",
    "45",
    "46",
    "47",
    "52",
    "53",
    "6",
    "64",
    "67",
    "7",
    "71",
    "73",
    "78",
    "79",
    "8",
    "80",
    "88",
    "9",
    "92"
  ],
  "notes": [
    {
      "type": "Maintenance",
      "text": "\n      \t\t\tThis entry likely has some relationships with case sensitivity (CWE-178), but case sensitivity is a factor in other types of weaknesses besides comparison.  Also, in cryptography, certain attacks are possible when certain comparison operations do not take place in constant time, causing a timing-related information leak (CWE-208).  \n      \t\t"
    }
  ]
}

{
  "id": "412",
  "name": "Unrestricted Externally Accessible Lock",
  "abstraction": "Base",
  "structure": "Simple",
  "status": "Incomplete",
  "description": "The software properly checks for the existence of a lock, but the lock can be externally controlled or influenced by an actor that is outside of the intended sphere of control.",
  "extended_description": "This prevents the software from acting on associated resources or performing other behaviors that are controlled by the presence of the lock. Relevant locks might include an exclusive lock or mutex, or modifying a shared resource that is treated as a lock. If the lock can be held for an indefinite period of time, then the denial of service could be permanent.",
  "related_weaknesses": [
    {
      "nature": "ChildOf",
      "cweid": "667",
      "view_id": "1000",
      "ordinal": "Primary"
    },
    {
      "nature": "CanAlsoBe",
      "cweid": "410",
      "view_id": "1000"
    }
  ],
  "applicable_platforms": {
    "language": [
      {
        "class": "Language-Independent",
        "prevalence": "Undetermined"
      }
    ]
  },
  "modes_of_introduction": [
    {
      "phase": "Architecture and Design"
    },
    {
      "phase": "Implementation"
    }
  ],
  "common_consequences": [
    {
      "scope": [
        "Availability"
      ],
      "impact": [
        "DoS: Resource Consumption (Other)"
      ],
      "note": "When an attacker can control a lock, the program may wait indefinitely until the attacker releases the lock, causing a denial of service to other users of the program. This is especially problematic if there is a blocking operation on the lock."
    }
  ],
  "potential_mitigations": [
    {
      "phase": [
        "Architecture and Design",
        "Implementation"
      ],
      "description": [
        "Use any access control that is offered by the functionality that is offering the lock."
      ]
    },
    {
      "phase": [
        "Architecture and Design",
        "Implementation"
      ],
      "description": [
        "Use unpredictable names or identifiers for the locks. This might not always be possible or feasible."
      ]
    },
    {
      "phase": [
        "Architecture and Design"
      ],
      "description": [
        "Consider modifying your code to use non-blocking synchronization methods."
      ]
    }
  ],
  "demonstrative_examples": [
    {
      "demonstrative_example_id": "DX-69",
      "text": "\n               \u003cIntro_Text\u003eThis code tries to obtain a lock for a file, then writes to it.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"PHP\"\u003e\n                  \u003cxhtml:div\u003efunction writeToLog($message){\u003cxhtml:div style=\"margin-left:10px;\"\u003e$logfile = fopen(\"logFile.log\", \"a\");\u003cxhtml:br/\u003e\n                        \u003cxhtml:i\u003e//attempt to get logfile lock\u003c/xhtml:i\u003e\n                        \u003cxhtml:br/\u003eif (flock($logfile, LOCK_EX)) {\u003cxhtml:div style=\"margin-left:10px;\"\u003efwrite($logfile,$message);\u003cxhtml:br/\u003e\n                           \u003cxhtml:i\u003e// unlock logfile\u003c/xhtml:i\u003e\n                           \u003cxhtml:br/\u003eflock($logfile, LOCK_UN);\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003eelse {\u003cxhtml:div style=\"margin-left:10px;\"\u003eprint \"Could not obtain lock on logFile.log, message not recorded\\n\";\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003efclose($logFile);\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003ePHP by default will wait indefinitely until a file lock is released. If an attacker is able to obtain the file lock, this code will pause execution, possibly leading to denial of service for other users. Note that in this case, if an attacker can perform an flock() on the file, they may already have privileges to destroy the log file. However, this still impacts the execution of other programs that depend on flock().\u003c/Body_Text\u003e\n            "
    }
  ],
  "observed_examples": [
    {
      "reference": "CVE-2001-0682",
      "description": "Program can not execute when attacker obtains a mutex.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2001-0682"
    },
    {
      "reference": "CVE-2002-1914",
      "description": "Program can not execute when attacker obtains a lock on a critical output file.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-1914"
    },
    {
      "reference": "CVE-2002-1915",
      "description": "Program can not execute when attacker obtains a lock on a critical output file.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-1915"
    },
    {
      "reference": "CVE-2002-0051",
      "description": "Critical file can be opened with exclusive read access by user, preventing application of security policy. Possibly related to improper permissions, large-window race condition.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-0051"
    },
    {
      "reference": "CVE-2000-0338",
      "description": "Chain: predictable file names used for locking, allowing attacker to create the lock beforehand. Resultant from permissions and randomness.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-0338"
    },
    {
      "reference": "CVE-2000-1198",
      "description": "Chain: Lock files with predictable names. Resultant from randomness.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2000-1198"
    },
    {
      "reference": "CVE-2002-1869",
      "description": "Product does not check if it can write to a log file, allowing attackers to avoid logging by accessing the file using an exclusive lock. Overlaps unchecked error condition. This is not quite CWE-412, but close.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-1869"
    }
  ],
  "content_history": {
    "submission": {
      "submission_name": "PLOVER",
      "submission_date": "2006-07-19T00:00:00Z"
    },
    "modification": [
      {
        "modification_name": "Eric Dalci",
        "modification_organization": "Cigital",
        "modification_date": "2008-07-01T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations, Time_of_Introduction"
      },
      {
        "modification_organization": "KDM Analytics",
        "modification_date": "2008-08-01T00:00:00Z",
        "modification_comment": "added/updated white box definitions"
      },
      {
        "modification_organization": "Veracode",
        "modification_date": "2008-08-15T00:00:00Z",
        "modification_comment": "Suggested OWASP Top Ten 2004 mapping"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-09-08T00:00:00Z",
        "modification_comment": "updated Common_Consequences, Description, Detection_Factors, Relationships, Observed_Example, Relationship_Notes, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-10-14T00:00:00Z",
        "modification_comment": "updated Description"
      },
      {
        "modification_name": "KDM Analytics",
        "modification_date": "2009-07-17T00:00:00Z",
        "modification_comment": "Suggested a better name and the minimal relationship with resources regardless of their criticality.",
        "modification_importance": "Critical"
      },
      {
        "modification_name": "KDM Analytics",
        "modification_date": "2009-07-17T00:00:00Z",
        "modification_comment": "Added a White_Box_Definition and clarified the consequences."
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-07-27T00:00:00Z",
        "modification_comment": "updated Common_Consequences, Description, Name, Potential_Mitigations, White_Box_Definitions"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-03-29T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-06-01T00:00:00Z",
        "modification_comment": "updated Common_Consequences, Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-05-11T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-07-30T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-11-08T00:00:00Z",
        "modification_comment": "updated Applicable_Platforms, Relationships, White_Box_Definitions"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-01-03T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-02-24T00:00:00Z",
        "modification_comment": "updated Relationships"
      }
    ],
    "previous_entry_name": [
      {
        "text": "Unrestricted Critical Resource Lock",
        "date": "2008-04-11T00:00:00Z"
      },
      {
        "text": "Unrestricted Lock on Critical Resource",
        "date": "2009-07-27T00:00:00Z"
      }
    ],
    "contribution": [
      {
        "type": "Feedback",
        "contribution_organization": "KDM Analytics",
        "contribution_date": "2008-08-29T00:00:00Z",
        "contribution_comment": "suggested clarification of description and observed examples, which were vague and inconsistent."
      }
    ]
  },
  "detection_methods": [
    {
      "method": "White Box",
      "description": "Automated code analysis techniques might not be able to reliably detect this weakness, since the application's behavior and general security model dictate which resource locks are critical. Interpretation of the weakness might require knowledge of the environment, e.g. if the existence of a file is used as a lock, but the file is created in a world-writable directory."
    }
  ],
  "taxonomy_mappings": [
    {
      "taxonomy_name": "PLOVER",
      "entry_name": "Unrestricted Critical Resource Lock"
    },
    {
      "taxonomy_name": "7 Pernicious Kingdoms",
      "entry_name": "Deadlock"
    },
    {
      "taxonomy_name": "OWASP Top Ten 2004",
      "entry_name": "Denial of Service",
      "entry_id": "A9",
      "mapping_fit": "CWE More Specific"
    },
    {
      "taxonomy_name": "The CERT Oracle Secure Coding Standard for Java (2011)",
      "entry_name": "Use private final lock objects to synchronize classes that may interact with untrusted code",
      "entry_id": "LCK00-J"
    },
    {
      "taxonomy_name": "The CERT Oracle Secure Coding Standard for Java (2011)",
      "entry_name": "Avoid deadlock by requesting and releasing locks in the same order",
      "entry_id": "LCK07-J"
    },
    {
      "taxonomy_name": "Software Fault Patterns",
      "entry_name": "Unrestricted lock",
      "entry_id": "SFP22"
    }
  ],
  "related_attack_patterns": [
    "25"
  ],
  "notes": [
    {
      "type": "Relationship",
      "text": "This overlaps Insufficient Resource Pool when the \"pool\" is of size 1. It can also be resultant from race conditions, although the timing window could be quite large in some cases."
    }
  ]
}

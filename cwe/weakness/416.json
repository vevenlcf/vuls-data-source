{
  "id": "416",
  "name": "Use After Free",
  "abstraction": "Variant",
  "structure": "Simple",
  "status": "Stable",
  "description": "Referencing memory after it has been freed can cause a program to crash, use unexpected values, or execute code.",
  "extended_description": "\n            \u003cxhtml:p\u003eThe use of previously-freed memory can have any number of adverse consequences, ranging from the corruption of valid data to the execution of arbitrary code, depending on the instantiation and timing of the flaw. The simplest way data corruption may occur involves the system's reuse of the freed memory. Use-after-free errors have two common and sometimes overlapping causes:\u003c/xhtml:p\u003e\n            \u003cxhtml:div style=\"margin-left:10px;\"\u003e\n               \u003cxhtml:ul\u003e\n                  \u003cxhtml:li\u003eError conditions and other exceptional circumstances.\u003c/xhtml:li\u003e\n                  \u003cxhtml:li\u003eConfusion over which part of the program is responsible for freeing the memory.\u003c/xhtml:li\u003e\n               \u003c/xhtml:ul\u003e\n            \u003c/xhtml:div\u003e\n            \u003cxhtml:p\u003eIn this scenario, the memory in question is allocated to another pointer validly at some point after it has been freed. The original pointer to the freed memory is used again and points to somewhere within the new allocation. As the data is changed, it corrupts the validly used memory; this induces undefined behavior in the process.\u003c/xhtml:p\u003e\n            \u003cxhtml:p\u003eIf the newly allocated data chances to hold a class, in C++ for example, various function pointers may be scattered within the heap data. If one of these function pointers is overwritten with an address to valid shellcode, execution of arbitrary code can be achieved.\u003c/xhtml:p\u003e\n         ",
  "related_weaknesses": [
    {
      "nature": "ChildOf",
      "cweid": "825",
      "view_id": "1000",
      "ordinal": "Primary"
    },
    {
      "nature": "ChildOf",
      "cweid": "672",
      "view_id": "1003",
      "ordinal": "Primary"
    },
    {
      "nature": "ChildOf",
      "cweid": "672",
      "view_id": "1305",
      "ordinal": "Primary"
    },
    {
      "nature": "ChildOf",
      "cweid": "672",
      "view_id": "1340",
      "ordinal": "Primary"
    },
    {
      "nature": "CanPrecede",
      "cweid": "120",
      "view_id": "1000"
    },
    {
      "nature": "CanPrecede",
      "cweid": "123",
      "view_id": "1000"
    }
  ],
  "applicable_platforms": {
    "language": [
      {
        "prevalence": "Undetermined",
        "name": "C"
      },
      {
        "prevalence": "Undetermined",
        "name": "C++"
      }
    ]
  },
  "modes_of_introduction": [
    {
      "phase": "Architecture and Design"
    },
    {
      "phase": "Implementation"
    }
  ],
  "likelihood_of_exploit": "High",
  "common_consequences": [
    {
      "scope": [
        "Integrity"
      ],
      "impact": [
        "Modify Memory"
      ],
      "note": "The use of previously freed memory may corrupt valid data, if the memory area in question has been allocated and used properly elsewhere."
    },
    {
      "scope": [
        "Availability"
      ],
      "impact": [
        "DoS: Crash, Exit, or Restart"
      ],
      "note": "If chunk consolidation occurs after the use of previously freed data, the process may crash when invalid data is used as chunk information."
    },
    {
      "scope": [
        "Integrity",
        "Confidentiality",
        "Availability"
      ],
      "impact": [
        "Execute Unauthorized Code or Commands"
      ],
      "note": "If malicious data is entered before chunk consolidation can take place, it may be possible to take advantage of a write-what-where primitive to execute arbitrary code."
    }
  ],
  "potential_mitigations": [
    {
      "phase": [
        "Architecture and Design"
      ],
      "description": [
        "Choose a language that provides automatic memory management."
      ]
    },
    {
      "phase": [
        "Implementation"
      ],
      "description": [
        "When freeing pointers, be sure to set them to NULL once they are freed. However, the utilization of multiple or complex data structures may lower the usefulness of this strategy."
      ]
    }
  ],
  "demonstrative_examples": [
    {
      "text": "\n               \u003cIntro_Text\u003eThe following example demonstrates the weakness.\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"C\"\u003e\n                  \u003cxhtml:div\u003e#include \u0026lt;stdio.h\u0026gt;\u003cxhtml:br/\u003e#include \u0026lt;unistd.h\u0026gt;\u003cxhtml:br/\u003e#define BUFSIZER1 512\u003cxhtml:br/\u003e#define BUFSIZER2 ((BUFSIZER1/2) - 8)\u003cxhtml:br/\u003eint main(int argc, char **argv) {\u003cxhtml:div style=\"margin-left:10px;\"\u003echar *buf1R1;\u003cxhtml:br/\u003echar *buf2R1;\u003cxhtml:br/\u003echar *buf2R2;\u003cxhtml:br/\u003echar *buf3R2;\u003cxhtml:br/\u003ebuf1R1 = (char *) malloc(BUFSIZER1);\u003cxhtml:br/\u003ebuf2R1 = (char *) malloc(BUFSIZER1);\u003cxhtml:br/\u003efree(buf2R1);\u003cxhtml:br/\u003ebuf2R2 = (char *) malloc(BUFSIZER2);\u003cxhtml:br/\u003ebuf3R2 = (char *) malloc(BUFSIZER2);\u003cxhtml:br/\u003estrncpy(buf2R1, argv[1], BUFSIZER1-1);\u003cxhtml:br/\u003efree(buf1R1);\u003cxhtml:br/\u003efree(buf2R2);\u003cxhtml:br/\u003efree(buf3R2);\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n            "
    },
    {
      "text": "\n               \u003cIntro_Text\u003eThe following code illustrates a use after free error:\u003c/Intro_Text\u003e\n               \u003cExample_Code Nature=\"bad\" Language=\"C\"\u003e\n                  \u003cxhtml:div\u003echar* ptr = (char*)malloc (SIZE);\u003cxhtml:br/\u003eif (err) {\u003cxhtml:div style=\"margin-left:10px;\"\u003eabrt = 1;\u003cxhtml:br/\u003efree(ptr);\u003c/xhtml:div\u003e}\u003cxhtml:br/\u003e...\u003cxhtml:br/\u003eif (abrt) {\u003cxhtml:div style=\"margin-left:10px;\"\u003elogError(\"operation aborted before commit\", ptr);\u003c/xhtml:div\u003e}\u003c/xhtml:div\u003e\n               \u003c/Example_Code\u003e\n               \u003cBody_Text\u003eWhen an error occurs, the pointer is immediately freed. However, this pointer is later incorrectly used in the logError function.\u003c/Body_Text\u003e\n            "
    }
  ],
  "observed_examples": [
    {
      "reference": "CVE-2021-0920",
      "description": "Chain: mobile platform race condition (CWE-362) leading to use-after-free (CWE-416), as exploited in the wild per CISA KEV.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-0920"
    },
    {
      "reference": "CVE-2020-6819",
      "description": "Chain: race condition (CWE-362) leads to use-after-free (CWE-416), as exploited in the wild per CISA KEV.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-6819"
    },
    {
      "reference": "CVE-2010-4168",
      "description": "Use-after-free triggered by closing a connection while data is still being transmitted.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-4168"
    },
    {
      "reference": "CVE-2010-2941",
      "description": "Improper allocation for invalid data leads to use-after-free.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-2941"
    },
    {
      "reference": "CVE-2010-2547",
      "description": "certificate with a large number of Subject Alternate Names not properly handled in realloc, leading to use-after-free",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-2547"
    },
    {
      "reference": "CVE-2010-1772",
      "description": "Timers are not disabled when a related object is deleted",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1772"
    },
    {
      "reference": "CVE-2010-1437",
      "description": "Access to a \"dead\" object that is being cleaned up",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1437"
    },
    {
      "reference": "CVE-2010-1208",
      "description": "object is deleted even with a non-zero reference count, and later accessed",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-1208"
    },
    {
      "reference": "CVE-2010-0629",
      "description": "use-after-free involving request containing an invalid version number",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-0629"
    },
    {
      "reference": "CVE-2010-0378",
      "description": "unload of an object that is currently being accessed by other functionality",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-0378"
    },
    {
      "reference": "CVE-2010-0302",
      "description": "incorrectly tracking a reference count leads to use-after-free",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-0302"
    },
    {
      "reference": "CVE-2010-0249",
      "description": "use-after-free related to use of uninitialized memory",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-0249"
    },
    {
      "reference": "CVE-2010-0050",
      "description": "HTML document with incorrectly-nested tags",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-0050"
    },
    {
      "reference": "CVE-2009-3658",
      "description": "Use after free in ActiveX object by providing a malformed argument to a method",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3658"
    },
    {
      "reference": "CVE-2009-3616",
      "description": "use-after-free by disconnecting during data transfer, or a message containing incorrect data types",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3616"
    },
    {
      "reference": "CVE-2009-3553",
      "description": "disconnect during a large data transfer causes incorrect reference count, leading to use-after-free",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3553"
    },
    {
      "reference": "CVE-2009-2416",
      "description": "use-after-free found by fuzzing",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-2416"
    },
    {
      "reference": "CVE-2009-1837",
      "description": "Chain: race condition (CWE-362) from improper handling of a page transition in web client while an applet is loading (CWE-368) leads to use after free (CWE-416)",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-1837"
    },
    {
      "reference": "CVE-2009-0749",
      "description": "realloc generates new buffer and pointer, but previous pointer is still retained, leading to use after free",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-0749"
    },
    {
      "reference": "CVE-2010-3328",
      "description": "Use-after-free in web browser, probably resultant from not initializing memory.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-3328"
    },
    {
      "reference": "CVE-2008-5038",
      "description": "use-after-free when one thread accessed memory that was freed by another thread",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-5038"
    },
    {
      "reference": "CVE-2008-0077",
      "description": "assignment of malformed values to certain properties triggers use after free",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-0077"
    },
    {
      "reference": "CVE-2006-4434",
      "description": "mail server does not properly handle a long header.",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-4434"
    },
    {
      "reference": "CVE-2010-2753",
      "description": "chain: integer overflow leads to use-after-free",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2010-2753"
    },
    {
      "reference": "CVE-2006-4997",
      "description": "freed pointer dereference",
      "link": "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-4997"
    }
  ],
  "references": [
    {
      "reference_id": "REF-6",
      "author": [
        "Katrina Tsipenyuk",
        "Brian Chess",
        "Gary McGraw"
      ],
      "title": "Seven Pernicious Kingdoms: A Taxonomy of Software Security Errors",
      "url": "https://samate.nist.gov/SSATTM_Content/papers/Seven%20Pernicious%20Kingdoms%20-%20Taxonomy%20of%20Sw%20Security%20Errors%20-%20Tsipenyuk%20-%20Chess%20-%20McGraw.pdf",
      "publication_year": "2005",
      "publication_month": "--11",
      "publication_day": "---07",
      "publication": "NIST Workshop on Software Security Assurance Tools Techniques and Metrics",
      "publisher": "NIST"
    },
    {
      "reference_id": "REF-18",
      "author": [
        "Secure Software, Inc."
      ],
      "title": "The CLASP Application Security Process",
      "url": "https://cwe.mitre.org/documents/sources/TheCLASPApplicationSecurityProcess.pdf",
      "publication_year": "2005"
    },
    {
      "section": "\"Sin 8: C++ Catastrophes.\" Page 143",
      "reference_id": "REF-44",
      "author": [
        "Michael Howard",
        "David LeBlanc",
        "John Viega"
      ],
      "title": "24 Deadly Sins of Software Security",
      "publication_year": "2010",
      "publication": "McGraw-Hill"
    }
  ],
  "content_history": {
    "submission": {
      "submission_name": "7 Pernicious Kingdoms",
      "submission_date": "2006-07-19T00:00:00Z"
    },
    "modification": [
      {
        "modification_name": "Eric Dalci",
        "modification_organization": "Cigital",
        "modification_date": "2008-07-01T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations, Time_of_Introduction"
      },
      {
        "modification_organization": "KDM Analytics",
        "modification_date": "2008-08-01T00:00:00Z",
        "modification_comment": "added/updated white box definitions"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-09-08T00:00:00Z",
        "modification_comment": "updated Applicable_Platforms, Common_Consequences, Relationships, Observed_Example, Other_Notes, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2008-11-24T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-03-10T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-05-27T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2009-10-29T00:00:00Z",
        "modification_comment": "updated Common_Consequences"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2010-02-16T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2010-06-21T00:00:00Z",
        "modification_comment": "updated Potential_Mitigations"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2010-09-27T00:00:00Z",
        "modification_comment": "updated Observed_Examples, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2010-12-13T00:00:00Z",
        "modification_comment": "updated Alternate_Terms, Common_Consequences, Description, Observed_Examples, Other_Notes, Potential_Mitigations, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-03-29T00:00:00Z",
        "modification_comment": "updated Description"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-06-01T00:00:00Z",
        "modification_comment": "updated Common_Consequences"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-06-27T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2011-09-13T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2012-05-11T00:00:00Z",
        "modification_comment": "updated References, Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2014-07-30T00:00:00Z",
        "modification_comment": "updated Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2015-12-07T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2017-11-08T00:00:00Z",
        "modification_comment": "updated Demonstrative_Examples, Relationships, Taxonomy_Mappings, White_Box_Definitions"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-01-03T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-06-20T00:00:00Z",
        "modification_comment": "updated Relationships, Type"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2019-09-19T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-02-24T00:00:00Z",
        "modification_comment": "updated References, Relationships, Taxonomy_Mappings"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-06-25T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-08-20T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2020-12-10T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2021-07-20T00:00:00Z",
        "modification_comment": "updated Relationships"
      },
      {
        "modification_name": "CWE Content Team",
        "modification_organization": "MITRE",
        "modification_date": "2022-06-28T00:00:00Z",
        "modification_comment": "updated Observed_Examples, Relationships"
      }
    ]
  },
  "alternate_terms": [
    {
      "term": "Dangling pointer"
    },
    {
      "term": "Use-After-Free"
    }
  ],
  "taxonomy_mappings": [
    {
      "taxonomy_name": "7 Pernicious Kingdoms",
      "entry_name": "Use After Free"
    },
    {
      "taxonomy_name": "CLASP",
      "entry_name": "Using freed memory"
    },
    {
      "taxonomy_name": "CERT C Secure Coding",
      "entry_name": "Allocate and free memory in the same module, at the same level of abstraction",
      "entry_id": "MEM00-C"
    },
    {
      "taxonomy_name": "CERT C Secure Coding",
      "entry_name": "Store a new value in pointers immediately after free()",
      "entry_id": "MEM01-C"
    },
    {
      "taxonomy_name": "CERT C Secure Coding",
      "entry_name": "Do not access freed memory",
      "entry_id": "MEM30-C",
      "mapping_fit": "Exact"
    },
    {
      "taxonomy_name": "Software Fault Patterns",
      "entry_name": "Faulty Pointer Use",
      "entry_id": "SFP7"
    }
  ],
  "affected_resources": [
    "Memory"
  ]
}

{
  "vid": "d1ac6a6a-bea8-11eb-b87a-901b0ef719ab",
  "topic": "FreeBSD-kernel -- SMAP bypass",
  "description": "\n\t\u003ch1\u003eProblem Description:\u003c/h1\u003e\n\t\u003cp\u003eThe FreeBSD kernel enables SMAP during boot when the CPU reports that\n\tthe SMAP capability is present.  Subroutines such as copyin() and\n\tcopyout() are responsible for disabling SMAP around the sections of code\n\tthat perform user memory accesses.\u003c/p\u003e\n\t\u003cp\u003eSuch subroutines must handle page faults triggered when user memory is\n\tnot mapped.  The kernel's page fault handler checks the validity of the\n\tfault, and if it is indeed valid it will map a page and resume copying.\n\tIf the fault is invalid, the fault handler returns control to a\n\ttrampoline which aborts the operation and causes an error to be\n\treturned.  In this second scenario, a bug in the implementation of SMAP\n\tsupport meant that SMAP would remain disabled until the thread returns\n\tto user mode.\u003c/p\u003e\n\t\u003ch1\u003eImpact:\u003c/h1\u003e\n\t\u003cp\u003eThis bug may be used to bypass the protections provided by SMAP for the\n\tduration of a system call.  It could thus be combined with other kernel\n\tbugs to craft an exploit.\u003c/p\u003e\n      ",
  "affects": [
    {
      "name": "FreeBSD-kernel",
      "range": [
        {
          "lt": "13.0_1",
          "ge": "13.0"
        },
        {
          "lt": "12.2_7",
          "ge": "12.2"
        }
      ]
    }
  ],
  "dates": {
    "discovery": "2021-05-27T00:00:00Z",
    "entry": "2021-05-27T00:00:00Z"
  },
  "references": [
    {
      "source": "CVE",
      "text": "CVE-2021-29628"
    },
    {
      "source": "FreebsdSA",
      "text": "SA-21:11.smap"
    }
  ]
}
